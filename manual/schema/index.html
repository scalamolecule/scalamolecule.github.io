<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href='http://fonts.googleapis.com/css?family=Merriweather+Sans:400,300,300italic,400italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
  <title>Schema</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/highlight/styles/solarized_light.css" rel="stylesheet" />
  <link href="/css/style.css" rel="stylesheet">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="/img/apple-touch-icon-57-precomposed.png">
  <link rel="shortcut icon" href="/img/favicon.png">
  <link href="" rel="alternate" type="application/rss+xml" title="Molecule" />
</head>
<body>
<br>
<div class="container">
  <div class="col-md-12 column" style="padding-left:0px; ">
    <div class="col-md-12 column" style="padding-left:0px;height:30px;">

    <ul class="nav nav-pills">
      <li class="dropdown ">
        <a data-toggle="dropdown" href="http://scalamolecule.org/home/front/" target="_top" onclick="javascript:top.location = 'http:\/\/scalamolecule.org\/home\/front\/';return true;">Molecule</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="http://scalamolecule.org/home/front/">Home</a></li>
            <li><a href="http://scalamolecule.org/home/introduction/">Introduction</a></li>
            <li><a href="http://scalamolecule.org/home/about/">About</a></li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="http://scalamolecule.org/compare/overview/" target="_top" onclick="javascript:top.location = 'http:\/\/scalamolecule.org\/compare\/overview\/';return true;">Compare</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="http://scalamolecule.org/compare/datomic/">Datomic</a></li>
            <li class="dropdown-submenu">
              <a href="http://scalamolecule.org/compare/sql/">SQL</a>
              <ul class="dropdown-menu">
                <li><a href="http://scalamolecule.org/compare/sql/slick/">Slick</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="http://scalamolecule.org/learn/overview/" target="_top" onclick="javascript:top.location = 'http:\/\/scalamolecule.org\/learn\/overview\/';return true;">Learn</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li class="dropdown-submenu">
              <a href="http://scalamolecule.org/learn/tutorials/">Tutorials</a>
              <ul class="dropdown-menu">
                <li><a href="http://scalamolecule.org/learn/tutorials/seattle/">Seattle</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="http://scalamolecule.org/learn/videos/">Videos</a>
              <ul class="dropdown-menu">
                <li><a href="http://scalamolecule.org/learn/videos/2017-04-25_Marc_Grue/">Molecule presentation</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown active">
        <a data-toggle="dropdown" href="http://scalamolecule.org/manual/overview/" target="_top" onclick="javascript:top.location = 'http:\/\/scalamolecule.org\/manual\/overview\/';return true;">Manual</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="http://scalamolecule.org/manual/getting-started/">Getting started</a></li>
            <li class="dropdown-submenu">
              <a href="http://scalamolecule.org/manual/schema/">Schema</a>
              <ul class="dropdown-menu">
                <li><a href="http://scalamolecule.org/manual/schema/transaction/">Transaction</a></li>
              </ul>
            </li>
            <li><a href="http://scalamolecule.org/manual/insert/">Insert</a></li>
            <li><a href="http://scalamolecule.org/manual/update/">Update/retract</a></li>
            <li class="dropdown-submenu">
              <a href="http://scalamolecule.org/manual/query/">Query</a>
              <ul class="dropdown-menu">
                <li><a href="http://scalamolecule.org/manual/query/builder/">Builder</a></li>
                <li><a href="http://scalamolecule.org/manual/query/mapped/">Mapped attributes</a></li>
                <li><a href="http://scalamolecule.org/manual/query/expressions/">Expressions</a></li>
                <li><a href="http://scalamolecule.org/manual/query/aggregates/">Aggregates</a></li>
                <li><a href="http://scalamolecule.org/manual/query/parameterize/">Parameterize</a></li>
                <li><a href="http://scalamolecule.org/manual/query/relationships/">Relationships</a></li>
                <li><a href="http://scalamolecule.org/manual/query/bidirectional%20refs/">Bidirectional refs</a></li>
                <li><a href="http://scalamolecule.org/manual/query/txMetaData/">Tx meta data</a></li>
                <li><a href="http://scalamolecule.org/manual/query/composites/">Composites</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="http://scalamolecule.org/developer/overview/" target="_top" onclick="javascript:top.location = 'http:\/\/scalamolecule.org\/developer\/overview\/';return true;">Developer</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="http://scalamolecule.org/developer/boilerplate/">Boilerplate</a></li>
            <li><a href="http://scalamolecule.org/developer/transformation/">Transformation</a></li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="http://scalamolecule.org/community/overview/" target="_top" onclick="javascript:top.location = 'http:\/\/scalamolecule.org\/community\/overview\/';return true;">Community</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
        </ul>
      </li>
      <li>
        <div  style="padding-left:14px;padding-top:3px;height:24px;float:right;">
            <a href="https://github.com/scalamolecule/molecule" class="github-button" data-icon="octicon-star">Github</a>
            
          </div>
      </li>
    </ul>

</div>
  </div> 

<div class="col-sm-10 column" style="padding-left:8px;">
	

<h1 id="schema:e608d9ac6a0d5e2b6db229b78a3e65b4">Schema</h1>

<p>A <a href="http://docs.datomic.com/schema.html">Datomic <code>schema</code></a> defines the set of possible <code>attributes</code> that we can use.</p>

<h2 id="schema-definition-file:e608d9ac6a0d5e2b6db229b78a3e65b4">Schema definition file</h2>

<p>Molecule provides an intuitive and type-safe dsl to model your schema in a Schema definition file.
After each change you make in this file you need to <code>sbt compile</code> to use your updated schema with
your molecules.</p>

<p>Let&rsquo;s look at the schema definition of the Seattle example:</p>

<pre><code class="language-scala">package yourpackage
import molecule.schema.definition._  // import schema definition DSL

@InOut(3, 8)
object SeattleDefinition {

  trait Community {
    val name         = oneString.fullTextSearch
    val url          = oneString
    val category     = manyString.fullTextSearch
    val orgtype      = oneEnum('community, 'commercial, 'nonprofit, 'personal)
    val `type`       = oneEnum('email_list, 'twitter, 'facebook_page) // + more...
    val neighborhood = one[Neighborhood]
  }

  trait Neighborhood {
    val name     = oneString
    val district = one[District]
  }

  trait District {
    val name   = oneString
    val region = oneEnum('n, 'ne, 'e, 'se, 's, 'sw, 'w, 'nw)
  }
}
</code></pre>

<p>The outer object <code>SeattleDefinition</code> encapsulates our schema definition. All such objects have to have a
named ending in &ldquo;Definition&rdquo; in order for the MoleculePlugin to be able to find it.</p>

<h3 id="molecule-arity:e608d9ac6a0d5e2b6db229b78a3e65b4">Molecule arity</h3>

<p>The <code>@InOut(3, 8)</code> arity annotation instructs Molecule to generate boilerplate code with the ability to create
molecules with up to 8 attributes including up to 3 <a href="/manual/query/parameterize">input attributes</a>.</p>

<p>When developing your schema you might just set the first arity annotation variable for input attributes to <code>0</code> and
then later when your schema is stabilizing add the ability to make input molecules by setting it to 1, 2 or 3 (the maximum).
Using parameterized input attributes can be a performance
optimization since using input values in Datalog queries allow Datomic to cache the query.</p>

<p>The second arity annotation parameter basically tells how long molecules you can build (this doesn&rsquo;t affect
 how many attributes you can <em>define</em> in each namespace). Generally you want to keep this number as low as possible
 not to generate more boilerplate code than necessary. The maximum arity is 22, the same as for tuples.</p>

<p>If you at some point need to make molecules with more than 22 attributes
  you can insert/query in two steps as described <a href="/manual/query/builder">here</a>.</p>

<h3 id="namespaces:e608d9ac6a0d5e2b6db229b78a3e65b4">Namespaces</h3>

<p>Attribute names in Datomic are namespaced keywords with the lexical form <code>&lt;namespace&gt;/&lt;name&gt;</code>. Molecule lets you
define the <code>&lt;namespace&gt;</code> part with the name of the trait, like <code>Community</code> in the Seattle
example above. In this way Molecule can construct the full name of the <code>community/category</code> attribute etc.</p>

<p><img src="/img/DatomicElements1.png" alt="Schema" />
</p>

<p>We might as well have defined a list of attributes manually adding a namespace
part to each attribute:</p>

<pre><code>val communityName
val communityUrl
//...

val neighborhoodName
// etc...
</code></pre>

<h4 id="namespace-table:e608d9ac6a0d5e2b6db229b78a3e65b4">Namespace != Table</h4>

<p>If coming from an sql background one might at first think of a namespace as
a table having columns (attributes). But this is not the case. An
entity in Datomic can associate values of attributes <em>from any namespace</em>:</p>

<p><img src="/img/DatomicElements2.png" alt="" />
</p>

<p>So, when we build a molecule</p>

<pre><code>val toughCommunities = Community.name.Neighborhood.name(&quot;Tough&quot;).get
</code></pre>

<p>we <em>shouldn&rsquo;t</em> think of it like a</p>

<p>&ldquo;<code>Community</code> table with <code>name</code> field with a join to <code>Neighborhood</code> table with a <code>name</code> field set to &ldquo;Tough&rdquo; (wrong!)</p>

<p>but rather think it as</p>

<p>&ldquo;<strong><em>entities</em></strong> with a <code>communityName</code> attribute and a reference to an entity having a <code>neighborhoodName</code> value equalling
&ldquo;Tough&rdquo;</p>

<h3 id="partitions:e608d9ac6a0d5e2b6db229b78a3e65b4">Partitions</h3>

<p>Namespaces can also be organized in partitions.</p>

<p>From the <a href="http://docs.datomic.com/schema.html">Datomic schema</a> reference:</p>

<p>&ldquo;All entities created in a database reside within a partition. Partitions group data together, providing locality of reference
when executing queries across a collection of entities. In general, you want to group entities based on how you&rsquo;ll use them.
Entities you&rsquo;ll often query across - like the community-related entities in our sample data - should be in the same partition
to increase query performance. Different logical groups of entities should be in different partitions. Partitions are discussed
in more detail in the Indexes topic.&rdquo;</p>

<p>In Molecule we can organize namespaces in partitions with objects:</p>

<pre><code class="language-scala">@InOut(0, 4)
object PartitionTestDefinition {

  object gen {
    trait Person {
      val name   = oneString
      val gender = oneEnum('male, 'female)
    }
    // ..more namespaces in the `gen` partition
  }

  object lit {
    trait Book {
      val title  = oneString
      val author = one[gen.Person]
      // To avoid attr/partition name clashes we can prepend the definition object name
      // (in case we would have needed an attribute named `gen` for instance)
      val editor = one[PartitionTestDefinition.gen.Person]
      val cat    = oneEnum('good, 'bad)
    }
    // ..more namespaces in the `lit` partition
  }
}
</code></pre>

<p>Here we have a <code>gen</code> (general) partition and a <code>lit</code> (litterature) partition. Each partition can contain as many
namespaces as you want. This can be a way also to structure large domains conceptually. The partition name is
prepended to the namespaces it contains.</p>

<p>When we build molecules the partition name is prepended to the namespace like this:</p>

<pre><code class="language-scala">lit_Book.title.cat.Author.name.gender.get === ...
</code></pre>

<p>Since <code>Author</code> is already defined as a related namespace we don&rsquo;t need to prepend the partition name there.</p>

<p>When we insert a <code>Person</code> the created entity will automatically be saved in the <code>gen</code> partition (or whatever we call it).</p>

<h2 id="attribute-types:e608d9ac6a0d5e2b6db229b78a3e65b4">Attribute types</h2>

<p>In the Seattle example we see the attributes being defined with the following types that should be
 pretty self-explanatory:</p>

<ul>
<li><code>oneString</code>, <code>manyString</code> etc defines cardinality and type of an attribute</li>
<li><code>oneEnum</code>/<code>manyEnum</code> defines enumerated values (pre-defined words)</li>
<li><code>one[&lt;ReferencedNamespace&gt;]</code> defines a reference to another namespace</li>
</ul>

<p>We can define the following types of attributes:</p>

<pre><code>Cardinality one              Cardinality many                 Mapped cardinality many
-------------------          -------------------------        --------------------------------
oneString     : String       manyString    : Set[String]      mapString     : Map[String, String]
oneInt        : Int          manyInt       : Set[Int]         mapInt        : Map[String, Int]
oneLong       : Long         manyLong      : Set[Long]        mapLong       : Map[String, Long]
oneFloat      : Float        manyFloat     : Set[Float]       mapFloat      : Map[String, Float]
oneDouble     : Double       manyDouble    : Set[Double]      mapDouble     : Map[String, Double]
oneBigInt     : BigInt       manyBigInt    : Set[BigInt]      mapBigInt     : Map[String, BigInt]
oneBigDecimal : BigDecimal   manyBigDecimal: Set[BigDecimal]  mapBigDecimal : Map[String, BigDecimal]
oneBoolean    : Boolean      manyBoolean   : Set[Boolean]     mapBoolean    : Map[String, Boolean]
oneDate       : Date         manyDate      : Set[Date]        mapDate       : Map[String, Date]
oneUUID       : UUID         manyUUID      : Set[UUID]        mapUUID       : Map[String, UUID]
oneURI        : URI          manyURI       : Set[URI]         mapURI        : Map[String, URI]
oneEnum       : String       manyEnum      : Set[String]
</code></pre>

<p>Cardinality-one attributes can have one value per entity.</p>

<p>Cardinality-many attributes can have a <em>Set of unique values</em> per entity. Often we choose instead to model many-values as a
many-reference to another entity that could have more than one attribute.</p>

<p>Mapped cardinality many attributes are a special Molecule variation based on cardinality-many attributes. Read more <a href="/manual/query/mapped">here</a>&hellip;</p>

<h3 id="reference-types:e608d9ac6a0d5e2b6db229b78a3e65b4">Reference types</h3>

<p>References are also treated like attributes. It&rsquo;s basically a reference to one or many entities.
We define such relationship by supplying the referenced namespace as the type parameter to <code>one</code>/<code>many</code>:</p>

<pre><code>Cardinality one         Cardinality many
---------------         ----------------
one[&lt;Ref-namespace&gt;]    many[&lt;Ref-namespace&gt;]
</code></pre>

<p>In the example above we saw a reference from Community to Neighborhood defined as <code>one[Neighborhood]</code>. We would for instance
likely define an Order/OrderLine relationship in an Order namespace as <code>many[OrderLine]</code>.</p>

<h2 id="attribute-options:e608d9ac6a0d5e2b6db229b78a3e65b4">Attribute options</h2>

<p>Each attribute can also have some extra options:</p>

<p>
<table border="1" cellpadding="5" cellspacing="0" style="background-color:#f5f5f5;">
  <tr>
    <th align="left" valign="top" scope="col">Option</th>
    <th valign="top" scope="col"><strong>Indexes</strong></th>
    <th scope="col">Description</th>
  </tr>
  <tr valign="top">
    <td valign="top">doc</td>
    <td align="center" valign="top">&nbsp;</td>
    <td>Attribute description.</td>
  </tr>
  <tr valign="top">
    <td valign="top">uniqueValue</td>
    <td align="center" valign="top">✔︎</td>
    <td>Attribute value is unique to each entity.<br>
      <em>Attempts to insert a duplicate value for a different entity id will fail.</em></td>
  </tr>
  <tr valign="top">
    <td valign="top">uniqueIdentity</td>
    <td align="center" valign="top">✔︎</td>
    <td>Attribute value is unique to each entity and &quot;upsert&quot; is enabled.<br>
      <em>Attempts to insert a duplicate value for a temporary entity id will cause all attributes associated with that temporary 
      id to be merged with the entity already in the database.</em></td>
  </tr>
  <tr>
    <td valign="top">indexed</td>
    <td align="center" valign="top">✔︎</td>
    <td>Generated index for this attribute.</td>
  </tr>
  <tr>
    <td valign="top">fullTextSearch</td>
    <td align="center" valign="top">✔︎</td>
    <td>Generate eventually consistent fulltext search index for this attribute.</td>
  </tr>
  <tr>
    <td valign="top">isComponent</td>
    <td align="center" valign="top">✔︎</td>
    <td>Specifies that an attribute whose type is :db.type/ref refers to a subcomponent of the entity to which the attribute is applied.<br>
    <em>When you retract an entity with :db.fn/retractEntity, all subcomponents are also retracted. When you touch an entity, all its 
    subcomponent entities are touched recursively.</em></td>
  </tr>
  <tr>
    <td valign="top">noHistory</td>
    <td align="center" valign="top">&nbsp;</td>
    <td>Whether past values of an attribute should not be retained.</td>
  </tr>
</table>
</p>

<p>Datomic indexes the values of all attributes having an option except for the <code>doc</code> and <code>noHistory</code> options.</p>

<p>As you saw, we added <code>fulltextSearch</code> to some of the attributes in the Seattle definition above. Molecule&rsquo;s schema
definition DSL let&rsquo;s you only choose allowed options for any attribute type.</p>

<h3 id="next:e608d9ac6a0d5e2b6db229b78a3e65b4">Next</h3>

<p><a href="/manual/schema/transaction">Create database</a>&hellip;</p>

</div>

<div class="col-sm-2 column" style="padding-left:20px;padding-top:22px">
  <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix">
    <ul class="bs-docs-sidenav">
      
        
          
            
              <li><a href="http://scalamolecule.org/manual/overview/">Manual</a></li>
              
            
          
            
              <li><a href="http://scalamolecule.org/manual/getting-started/">Getting started</a></li>
              
            
          
            
              <li class="active"><b>Schema</b></li>
              
                <ul class="level2">
                  <li><a href="http://scalamolecule.org/manual/schema/transaction/">Transaction</a></li>
                </ul>
              
            
          
            
              <li><a href="http://scalamolecule.org/manual/insert/">Insert</a></li>
              
            
          
            
              <li><a href="http://scalamolecule.org/manual/update/">Update/retract</a></li>
              
            
          
            
              <li><a href="http://scalamolecule.org/manual/query/">Query</a></li>
              
                <ul class="level2">
                  
                  <li><a href="http://scalamolecule.org/manual/query/builder/">Builder</a></li>
                  
                
                  
                  <li><a href="http://scalamolecule.org/manual/query/mapped/">Mapped attributes</a></li>
                  
                
                  
                  <li><a href="http://scalamolecule.org/manual/query/expressions/">Expressions</a></li>
                  
                
                  
                  <li><a href="http://scalamolecule.org/manual/query/aggregates/">Aggregates</a></li>
                  
                
                  
                  <li><a href="http://scalamolecule.org/manual/query/parameterize/">Parameterize</a></li>
                  
                
                  
                  <li><a href="http://scalamolecule.org/manual/query/relationships/">Relationships</a></li>
                  
                
                  
                  <li><a href="http://scalamolecule.org/manual/query/bidirectional%20refs/">Bidirectional refs</a></li>
                  
                
                  
                  <li><a href="http://scalamolecule.org/manual/query/txMetaData/">Tx meta data</a></li>
                  
                
                  
                  <li><a href="http://scalamolecule.org/manual/query/composites/">Composites</a></li>
                  
                
                </ul>
              
            
          
        
      
    </ul>
  </nav>
</div>

     
  </div> 
</div> 



<script type="text/javascript" src="/js/jquery-1.11.2.min.js"></script>



<script type="text/javascript" src="/js/bootstrap.min.js"></script>



<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript" src="/js/scripts.js"></script>




<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2787756-3', 'auto');
  ga('send', 'pageview');

</script>
    
</body>
</html>
