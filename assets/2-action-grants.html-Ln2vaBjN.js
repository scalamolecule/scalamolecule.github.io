import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,d as t,o as n}from"./app-DvhOcy9q.js";const h={};function l(e,s){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="layer-2-action-grants" tabindex="-1"><a class="header-anchor" href="#layer-2-action-grants"><span>Layer 2: Action Grants</span></a></h1><p>Let a role also have update/delete capabilities on an entity and its attributes.</p><h2 id="entity-level-update-grant" tabindex="-1"><a class="header-anchor" href="#entity-level-update-grant"><span>Entity-level update grant</span></a></h2><p>Use <code>with updating[Role]</code> to grant update capability:</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Member</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Role</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Role</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> save </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> insert </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> update </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> delete</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Post</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Member</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> updating[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Member</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] { </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Update grant - Member can update</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> content</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> title</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">   =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Comment</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Member</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// No update grant - Member cannot update</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Result:</strong></p><ul><li>Post: Member has query + <strong>update</strong> (from grant)</li><li>Comment: Member has query only (no grant)</li><li>Grants are per-entity, not global</li></ul><p><strong>Example:</strong></p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> adminConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;admin1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Admin&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> postId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">    =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Post</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.content(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Original&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).title(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Title&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).save.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> adminConn).id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> commentId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Comment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.text(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Comment&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).save.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> adminConn).id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> memberConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;member1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Member&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Member can update Post (has update grant)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Post</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(postId).content(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Updated&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).update.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> memberConn) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ✓</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Member cannot update Comment (no grant)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Comment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(commentId).text(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Updated&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).update.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> memberConn) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ✗</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Error: Access denied: Role &#39;Member&#39; cannot update entity &#39;Comment&#39;</span></span></code></pre></div><h2 id="entity-level-delete-grant" tabindex="-1"><a class="header-anchor" href="#entity-level-delete-grant"><span>Entity-level delete grant</span></a></h2><p>Use <code>with deleting[Role]</code> to grant delete capability:</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Moderator</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Role</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Role</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> save </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> insert </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> update </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> delete</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Comment</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Moderator</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deleting[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Moderator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] {</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Update grant - Moderator can delete</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Reply</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Moderator</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// No delete grant - Moderator cannot delete</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Result:</strong></p><ul><li>Comment: Moderator has query + <strong>delete</strong> (from grant)</li><li>Reply: Moderator has query only (no grant)</li><li>Grants are per-entity</li></ul><p><strong>Example:</strong></p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> adminConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;admin1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Admin&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> commentId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Comment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.text(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Comment&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).save.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> adminConn).id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> replyId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Reply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.text(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Reply&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).save.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> adminConn).id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> moderatorConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;mod1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Moderator&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Moderator can delete Comment (has delete grant)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Comment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(commentId).delete.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> moderatorConn)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ✓</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Moderator cannot delete Reply (no grant)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Reply</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(replyId).delete.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> moderatorConn)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ✗</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Error: Access denied: Role &#39;Moderator&#39; cannot delete entity &#39;Reply&#39;</span></span></code></pre></div><p>Delete grants apply to entity and all attributes. This ensures <code>Entity(id).delete</code> works correctly, as it affects all attribute values.</p><h2 id="action-grants-to-multiple-roles" tabindex="-1"><a class="header-anchor" href="#action-grants-to-multiple-roles"><span>Action grants to multiple roles</span></a></h2><p>Grant to multiple roles using tuple syntax:</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Article</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Member</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Moderator</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> updating[(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Member</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Moderator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)] { </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// two or more roles...</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> title</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> content</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Result:</strong></p><ul><li>Both Member and Moderator can update</li><li>Admin can update (already has action)</li></ul><p><strong>Example:</strong></p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> adminConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;admin1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Admin&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id1</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Article</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.title(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Article 1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).content(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Content 1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).save.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> adminConn).id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id2</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Article</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.title(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Article 2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).content(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Content 2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).save.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> adminConn).id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> memberConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;member1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Member&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> moderatorConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;mod1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Moderator&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Both can update</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Article</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id1).title(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Updated by Member&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).update.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> memberConn)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Article</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id2).title(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Updated by Moderator&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).update.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> moderatorConn)</span></span></code></pre></div><h2 id="combining-grants" tabindex="-1"><a class="header-anchor" href="#combining-grants"><span>Combining grants</span></a></h2><p>Combine updating and deleting grants:</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ModLog</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Moderator</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> updating[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Moderator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deleting[(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Moderator</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Admin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)] {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> timestamp</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneLong</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Result:</strong></p><ul><li>Moderator: query + <strong>update</strong> + <strong>delete</strong> (from grants)</li><li>Admin: all actions + <strong>delete</strong> (redundant, already has delete)</li></ul><p><strong>Example:</strong></p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> adminConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;admin1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Admin&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ModLog</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.action(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Action&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).timestamp(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123L</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).save.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> adminConn).id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> moderatorConn</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> baseConn.withAuth(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;mod1&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Moderator&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Moderator can update (updating grant)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ModLog</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id).action(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Updated&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).update.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> moderatorConn)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Moderator can delete (deleting grant)</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ModLog</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(id).delete.transact(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">using</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> moderatorConn)</span></span></code></pre></div><h2 id="explicit-action-grants" tabindex="-1"><a class="header-anchor" href="#explicit-action-grants"><span>Explicit action grants</span></a></h2><p>You can explicitly grant actions to roles that already have them. This guarantees the entity will always support that action for that role, even if the role definition changes:</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Role</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> save </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> insert </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> update </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> delete</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserProfile</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Member</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> updating[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Member</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deleting[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Admin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] {  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Explicit: ensure Admin can always delete</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> displayName</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>The <code>deleting[Admin]</code> grant is explicit - Admin already has delete, but this ensures UserProfile will always support Admin delete even if the Admin role definition changes later.</p><h2 id="compile-time-validation" tabindex="-1"><a class="header-anchor" href="#compile-time-validation"><span>Compile-time validation</span></a></h2><p>When we let sbt-molecule generate boilerplate code with <code>sbt moleculeGen</code>, the action grants are checked at compile-time.</p><ol><li><strong>Grants must reference entity roles:</strong></li></ol><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Post</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Member</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> updating[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Guest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] {  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ✗ Error - Guest not in entity roles</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> content</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ol start="2"><li><strong>Grants compatible with attribute restrictions:</strong></li></ol><p>If (layer 4) restrictions are applied to an attribute they take precedence over entity-level action grants.</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Document</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Member</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deleting[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Member</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] {  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ✗ Error - Member can&#39;t access secretNotes</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> title</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> secretNotes</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString.only[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Admin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Error: Entity grants deleting to &#39;Member&#39; but attribute &#39;secretNotes&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// is restricted with .only[Admin]</span></span></code></pre></div><p>Fix: Only grant to roles that can access all attributes:</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Document</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Member</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Admin</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> deleting[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Admin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] {  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ✓ OK</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> title</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> secretNotes</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString.only[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Admin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>Layer 2 adds flexibility:</p><ul><li>Grant update/delete to roles that lack these actions</li><li>Grants apply to entity and all attributes</li><li>Use tuple syntax for multiple roles</li><li>Grants are additive and per-entity</li><li>Compile-time validation ensures consistency</li></ul><h2 id="comparison-with-other-systems" tabindex="-1"><a class="header-anchor" href="#comparison-with-other-systems"><span>Comparison with other systems</span></a></h2><p><strong>Spring Security:</strong> Method-level <code>@PreAuthorize</code> annotations. Molecule centralizes grants in the domain rather than scattering across service methods.</p><p><strong>GraphQL:</strong> Action control typically implemented in resolvers. Molecule declares actions directly in the domain with compile-time validation.</p><p><strong>Casbin:</strong> Action permissions in policy files like <code>p, role, resource, action</code>. Molecule integrates action grants into the domain model with type safety.</p>`,51)])])}const r=i(h,[["render",l]]),d=JSON.parse('{"path":"/database/authorization/2-action-grants.html","title":"Layer 2: Action Grants","lang":"en-US","frontmatter":{"description":"Layer 2: Action Grants Let a role also have update/delete capabilities on an entity and its attributes. Entity-level update grant Use with updating[Role] to grant update capabil...","toc":{"levels":[2,3]},"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Layer 2: Action Grants\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-23T22:23:53.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://www.scalamolecule.org/intro/database/authorization/2-action-grants.html"}],["meta",{"property":"og:site_name","content":"Scala Molecule"}],["meta",{"property":"og:title","content":"Layer 2: Action Grants"}],["meta",{"property":"og:description","content":"Layer 2: Action Grants Let a role also have update/delete capabilities on an entity and its attributes. Entity-level update grant Use with updating[Role] to grant update capabil..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-23T22:23:53.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-23T22:23:53.000Z"}]]},"git":{"createdTime":1766528633000,"updatedTime":1766528633000,"contributors":[{"name":"marcgrue","username":"marcgrue","email":"marcgrue@gmail.com","commits":1,"url":"https://github.com/marcgrue"}]},"filePathRelative":"database/authorization/2-action-grants.md","autoDesc":true}');export{r as comp,d as data};
