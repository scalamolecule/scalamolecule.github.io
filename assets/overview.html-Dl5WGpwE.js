import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as o,d as r,a as s,e as t,b as a,w as n,r as h,o as p}from"./app-DvhOcy9q.js";const d={};function g(k,i){const e=h("RouteLink");return p(),o("div",null,[i[8]||(i[8]=r(`<h1 id="migration-overview" tabindex="-1"><a class="header-anchor" href="#migration-overview"><span>Migration overview</span></a></h1><p>Molecule provides automatic, type-safe database migration integration with Flyway.</p><h2 id="development" tabindex="-1"><a class="header-anchor" href="#development"><span>Development</span></a></h2><p>During early development we want to freely experiment with our domain structure and database schema. Molecule generates an SQL schema from your domain structure each time you run that you can use to test your ideas:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> moleculeGen</span></span></code></pre></div><p>The SQL schema files are saved in <code>resources/db/schema/</code> for each domain and database dialect.</p><h2 id="production" tabindex="-1"><a class="header-anchor" href="#production"><span>Production</span></a></h2><p>Then, when your domain has stabilized and you&#39;re ready to deploy to production, Molecule allows you to turn on migration handling with:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;moleculeGen initMigrations&quot;</span></span></code></pre></div><p>From now on Molecule will also generate Flyway migration files for each domain and database dialect in <code>resources/db/migration/</code>.</p><p>The current SQL schema files continue to be generated in <code>resources/db/schema/</code> for testing purposes.</p><h2 id="why-molecule-migrations" tabindex="-1"><a class="header-anchor" href="#why-molecule-migrations"><span>Why Molecule migrations?</span></a></h2><p>Most Scala projects use migration tools like Flyway or Liquibase, where you manually write SQL migration files for each schema change. This works well but requires:</p><ul><li>Writing SQL by hand for every change</li><li>Keeping migration SQL in sync with your domain structure</li><li>Maintaining separate migration files per database dialect</li></ul><h4 id="molecule-s-approach" tabindex="-1"><a class="header-anchor" href="#molecule-s-approach"><span>Molecule&#39;s approach</span></a></h4><p><em><strong>Let your Scala domain structure be your type-safe source of truth!</strong></em></p><p>This allows type-safe schema evolution without having to write manual SQL (although you can always do that too if you want, for edge cases for instance).</p><h2 id="how-it-works" tabindex="-1"><a class="header-anchor" href="#how-it-works"><span>How it works</span></a></h2><ol><li><strong>Make domain changes</strong> - Modify your domain structure</li><li><strong>Run <code>sbt moleculeGen</code></strong> - Molecule compares your new domain structure with your previous structure</li><li><strong>SQL is generated</strong> - Flyway migration file is automatically created</li><li><strong>Apply with Flyway</strong> - Run Flyway migration to update the database</li></ol><p>This allows you to evolve your domain structure without manually writing SQL.</p><h2 id="managing-migrations" tabindex="-1"><a class="header-anchor" href="#managing-migrations"><span>Managing migrations</span></a></h2><h3 id="initialize-migrations" tabindex="-1"><a class="header-anchor" href="#initialize-migrations"><span>Initialize migrations</span></a></h3><p>Enable migration tracking for your domain(s):</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Initialize for all domains</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;moleculeGen initMigrations&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Initialize for the Company domain only</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;moleculeGen initMigrations Company&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Initialize for multiple domains</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;moleculeGen initMigrations Company Social&quot;</span></span></code></pre></div><p>Alternatively, you can run these commands from within the SBT shell without quotes:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sbt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt:yourProject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">moleculeGen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> initMigrations</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt:yourProject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">moleculeGen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> initMigrations</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Company</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt:yourProject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">moleculeGen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> initMigrations</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Company</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Social</span></span></code></pre></div><p>This creates the initial migration file (V1__initial_schema.sql) and starts tracking future changes.</p><h3 id="check-migration-status" tabindex="-1"><a class="header-anchor" href="#check-migration-status"><span>Check migration status</span></a></h3><p>See which domains have migration handling enabled:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> moleculeMigrationStatus</span></span></code></pre></div><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>Active migrations:</span></span>
<span class="line"><span>  app.domain.Company - latest: V2__molecule_1_change.sql</span></span>
<span class="line"><span>  app.domain.Social  - latest: V1__initial_schema.sql</span></span></code></pre></div><h3 id="disable-migrations" tabindex="-1"><a class="header-anchor" href="#disable-migrations"><span>Disable migrations</span></a></h3><p>Remove migration tracking (back to development mode):</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Remove all migration tracking</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;moleculeGen deleteMigrations&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Remove for the Company domain only</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;moleculeGen deleteMigrations Company&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Remove for multiple domains</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;moleculeGen deleteMigrations Company Social&quot;</span></span></code></pre></div><p>Alternatively, from within the SBT shell:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt:yourProject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">moleculeGen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deleteMigrations</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt:yourProject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">moleculeGen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deleteMigrations</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Company</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sbt:yourProject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">moleculeGen</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deleteMigrations</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Company</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Social</span></span></code></pre></div><h2 id="what-can-be-migrated" tabindex="-1"><a class="header-anchor" href="#what-can-be-migrated"><span>What can be migrated</span></a></h2><p>Molecule tracks changes at all levels:</p><p><strong>Segments</strong> - Add, remove, or rename segments of entities</p><p><strong>Entities</strong> - Add, remove, or rename entities</p><p><strong>Attributes</strong> - Add, remove, or rename attributes, plus manage <code>.index</code> option</p><p><strong>Relationships</strong> - Add, remove, or rename foreign keys, plus manage <code>.owner</code> cascade behavior</p><h2 id="two-migration-paths" tabindex="-1"><a class="header-anchor" href="#two-migration-paths"><span>Two migration paths</span></a></h2><h3 id="unambiguous-migrations" tabindex="-1"><a class="header-anchor" href="#unambiguous-migrations"><span>Unambiguous migrations</span></a></h3><p>When you explicitly mark your intent with migration commands, Molecule can generate migration SQL immediately:</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Mark that &#39;name&#39; should be renamed to &#39;fullName&#39;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString.rename(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;fullName&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><p>Run <code>sbt moleculeGen</code> and migration SQL is generated.</p><h3 id="ambiguous-migrations" tabindex="-1"><a class="header-anchor" href="#ambiguous-migrations"><span>Ambiguous migrations</span></a></h3><p>When Molecule detects changes but can&#39;t infer your intent, it generates a <strong>Resolution file</strong>:</p><div class="language-scala" data-highlighter="shiki" data-ext="scala" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-scala"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// You removed &#39;name&#39; and added &#39;fullName&#39; - but was it renamed or replaced?</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">trait</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> PersonMigrations</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Person</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString.remove          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// if removed</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  val</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> oneString.becomes(fullName) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// if renamed</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>By commenting out or deleting one of the two options for an attribute, you tell Molecule which migration path you intended to take. Once resolved, you can then run <code>sbt moleculeGen</code> again to unambiguously produce the migration file.</p><p>This guarantees that your database schema is always in sync with your domain structure in a type-safe and unambiguous manner.</p><h2 id="type-safety" tabindex="-1"><a class="header-anchor" href="#type-safety"><span>Type safety</span></a></h2><p>The migration system prevents dangerous operations:</p><ul><li><strong>Type changes</strong> are disallowed (e.g., <code>oneInt</code> → <code>oneString</code>)</li><li><strong>Cardinality changes</strong> are disallowed (e.g., <code>oneString</code> → <code>manyString</code>)</li><li><strong>Cyclical renames</strong> are detected (e.g., swapping <code>email</code> and <code>phone</code>, or A→B→C→A)</li></ul><p>These scenarios require manual data transformation and cannot be safely automated.</p><h2 id="database-support" tabindex="-1"><a class="header-anchor" href="#database-support"><span>Database support</span></a></h2><p>Flyway migration files are generated for all database dialects supported by Molecule:</p><ul><li>H2</li><li>PostgreSQL</li><li>MySQL</li><li>MariaDB</li><li>SQLite (requires version 3.35.0+ for full support)</li></ul><p>Molecule automatically handles all database-specific details including SQL syntax variations, reserved word conflicts (by appending <code>_</code>), type mappings, and foreign key constraints. You don&#39;t need to worry about database differences—Molecule generates the correct SQL for your target database.</p><h2 id="next-steps" tabindex="-1"><a class="header-anchor" href="#next-steps"><span>Next steps</span></a></h2>`,61)),s("ul",null,[s("li",null,[t(e,{to:"/database/migration/unambiguous-changes.html"},{default:n(()=>[...i[0]||(i[0]=[a("Unambiguous changes",-1)])]),_:1}),i[1]||(i[1]=a(" - Learn the migration markers",-1))]),s("li",null,[t(e,{to:"/database/migration/ambiguous-changes.html"},{default:n(()=>[...i[2]||(i[2]=[a("Ambiguous changes",-1)])]),_:1}),i[3]||(i[3]=a(" - Resolve unclear scenarios",-1))]),s("li",null,[t(e,{to:"/database/migration/cleanup.html"},{default:n(()=>[...i[4]||(i[4]=[a("Automatic cleanup",-1)])]),_:1}),i[5]||(i[5]=a(" - Optional AST-based cleanup of migration markers",-1))]),s("li",null,[t(e,{to:"/database/migration/relationships.html"},{default:n(()=>[...i[6]||(i[6]=[a("Relationships",-1)])]),_:1}),i[7]||(i[7]=a(" - Migrate foreign keys",-1))])])])}const u=l(d,[["render",g]]),y=JSON.parse('{"path":"/database/migration/overview.html","title":"Migration overview","lang":"en-US","frontmatter":{"description":"Migration overview Molecule provides automatic, type-safe database migration integration with Flyway. Development During early development we want to freely experiment with our ...","toc":{"levels":[2,3]},"head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Migration overview\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-12-23T22:23:53.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://www.scalamolecule.org/intro/database/migration/overview.html"}],["meta",{"property":"og:site_name","content":"Scala Molecule"}],["meta",{"property":"og:title","content":"Migration overview"}],["meta",{"property":"og:description","content":"Migration overview Molecule provides automatic, type-safe database migration integration with Flyway. Development During early development we want to freely experiment with our ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-12-23T22:23:53.000Z"}],["meta",{"property":"article:modified_time","content":"2025-12-23T22:23:53.000Z"}]]},"git":{"createdTime":1766528633000,"updatedTime":1766528633000,"contributors":[{"name":"marcgrue","username":"marcgrue","email":"marcgrue@gmail.com","commits":1,"url":"https://github.com/marcgrue"}]},"filePathRelative":"database/migration/overview.md","autoDesc":true}');export{u as comp,y as data};
