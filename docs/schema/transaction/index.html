<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link href='http://fonts.googleapis.com/css?family=Merriweather+Sans:400,300,300italic,400italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
  <title>Transaction</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/highlight/styles/solarized_light.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="/vendor/font-awesome/css/font-awesome.min.css">
  <link href="/css/style.css" rel="stylesheet">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="/img/apple-touch-icon-57-precomposed.png">
  <link rel="shortcut icon" href="/img/favicon.png">
  <link href="" rel="alternate" type="application/rss+xml" title="Molecule" />
</head>
<body>
<div class="wrapper">
<div class="container" style="padding-top:20px">
  <div class="col-md-12 column" style="padding-left:0px; margin-bottom:15px">
    <div class="col-md-12 column" style="padding-left:0px;height:50px;">

    <ul class="nav nav-pills">
      <li><a href="/" style="padding-left: 6px; padding-right: 13px; vertical-align: top; margin-top: 0px;"><img src="/img/logo/MoleculeLogo600.png" alt="" width="200"></a></li>
      
      <li class="dropdown ">
        <a data-toggle="dropdown" href="/compare/" target="_top" onclick="javascript:top.location = '\/compare\/';return true;">Compare</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="/compare/datomic/">Datomic</a></li>
            <li class="dropdown-submenu">
              <a href="/compare/sql/">SQL</a>
              <ul class="dropdown-menu">
                <li><a href="/compare/sql/slick/">Slick</a></li>
              </ul>
            </li>
            <li><a href="/compare/gremlin/">Gremlin</a></li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="/resources/" target="_top" onclick="javascript:top.location = '\/resources\/';return true;">Resources</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li class="dropdown-submenu">
              <a href="/resources/tutorials/">Tutorials</a>
              <ul class="dropdown-menu">
                <li><a href="/resources/tutorials/seattle/">Seattle</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/resources/videos/">Videos</a>
              <ul class="dropdown-menu">
                <li><a href="/resources/videos/2017-04-25_marc_grue/">Molecule presentation</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown active">
        <a data-toggle="dropdown" href="/docs/" target="_top" onclick="javascript:top.location = '\/docs\/';return true;">Docs</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li class="dropdown-submenu">
              <a href="/docs/">Documentation</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/documentation/introduction/">Introduction</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/getting-started/">Getting started</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/getting-started/setup/">Setup</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/schema/">Schema</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/schema/transaction/">Transaction</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/attributes/">Attributes</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/attributes/basics/">Basics</a></li>
                <li><a href="/docs/attributes/modes/">Mandatory/Tacet/Optional</a></li>
                <li><a href="/docs/attributes/mapped/">Map attributes</a></li>
                <li><a href="/docs/attributes/expressions/">Expressions</a></li>
                <li><a href="/docs/attributes/aggregates/">Aggregates</a></li>
                <li><a href="/docs/attributes/parameterized/">Parameterized</a></li>
              </ul>
            </li>
            <li><a href="/docs/entities/">Entities</a></li>
            <li class="dropdown-submenu">
              <a href="/docs/relationships/">Relationships</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/relationships/card-one/">Cardinality one</a></li>
                <li><a href="/docs/relationships/card-many/">Cardinality many</a></li>
                <li><a href="/docs/relationships/composites/">Composites</a></li>
                <li><a href="/docs/relationships/bidirectional/">Bidirectional</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/crud/">CRUD</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/crud/save/">Save</a></li>
                <li><a href="/docs/crud/insert/">Insert</a></li>
                <li><a href="/docs/crud/get/">Get</a></li>
                <li><a href="/docs/crud/getjson/">Get Json</a></li>
                <li><a href="/docs/crud/update/">Update</a></li>
                <li><a href="/docs/crud/retract/">Retract</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/transactions/">Transactions</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/transactions/tx-meta-data/">Tx meta data</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/time/">Time</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/time/asof-since/">AsOf/Since</a></li>
                <li><a href="/docs/time/history/">History</a></li>
                <li><a href="/docs/time/with/">With</a></li>
                <li><a href="/docs/time/testing/">Testing</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="/dev/" target="_top" onclick="javascript:top.location = '\/dev\/';return true;">Dev</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="/dev/">Developer</a></li>
            <li><a href="/dev/boilerplate/">Boilerplate</a></li>
            <li><a href="/dev/transformation/">Transformation</a></li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="/community/" target="_top" onclick="javascript:top.location = '\/community\/';return true;">Community</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
        </ul>
      </li>
      <li>
        <div  style="padding-left:14px;padding-top:19px;height:24px;float:right;">
            <a href="https://github.com/scalamolecule/molecule" class="github-button" data-icon="octicon-star">Github</a>
            
          </div>
      </li>
    </ul>

</div>
  </div> 

<div class="col-sm-10 column" style="padding-left:8px;">
	

<h1 id="schema-transaction">Schema transaction</h1>

<p>To create our Datomic database we need to transact some schema transaction data in Datomic. This makes our
defined attributes available in Datomic.</p>

<h2 id="schema-transaction-data">Schema transaction data</h2>

<p>Molecule transforms our <a href="/docs/schema">Schema definition file</a> to
basically a <code>java.util.List</code> containing a <code>java.util.Map</code> of schema transaction data for each attribute defined.
Our <code>name</code> and <code>url</code> attributes for instance requires the following map of information to be transacted in Datomic:</p>

<pre><code class="language-scala">object SeattleSchema extends Transaction {
  
  lazy val partitions = Util.list()

  lazy val namespaces = Util.list(
    
    // Community --------------------------------------------------------

    Util.map(&quot;:db/ident&quot;             , &quot;:community/name&quot;,
             &quot;:db/valueType&quot;         , &quot;:db.type/string&quot;,
             &quot;:db/cardinality&quot;       , &quot;:db.cardinality/one&quot;,
             &quot;:db/fulltext&quot;          , true.asInstanceOf[Object],
             &quot;:db/index&quot;             , true.asInstanceOf[Object],
             &quot;:db/id&quot;                , Peer.tempid(&quot;:db.part/db&quot;),
             &quot;:db.install/_attribute&quot;, &quot;:db.part/db&quot;),

    Util.map(&quot;:db/ident&quot;             , &quot;:community/url&quot;,
             &quot;:db/valueType&quot;         , &quot;:db.type/string&quot;,
             &quot;:db/cardinality&quot;       , &quot;:db.cardinality/one&quot;,
             &quot;:db/index&quot;             , true.asInstanceOf[Object],
             &quot;:db/id&quot;                , Peer.tempid(&quot;:db.part/db&quot;),
             &quot;:db.install/_attribute&quot;, &quot;:db.part/db&quot;),
             
    // etc...
}
</code></pre>

<p>As you see, the <code>Community</code> namespace information is present in the value of the first pair in the map for
the <code>name</code> attribute:</p>

<pre><code class="language-scala">&quot;:db/ident&quot;, &quot;:community/name&quot;,
</code></pre>

<p>The rest of the lines are pretty self-describing except from the last two that create and save the
internal id of the attribute in Datomic. <a href="http://docs.datomic.com/schema.html">Datomic schemas</a> are
literally a set of datoms that have been transacted as any other data!</p>

<h3 id="partition-transaction-data">Partition transaction data</h3>

<p>Partition transaction data looks almost like attribute transaction data:</p>

<pre><code class="language-scala">lazy val partitions = Util.list(

Util.map(&quot;:db/ident&quot;             , &quot;:gen&quot;,
         &quot;:db/id&quot;                , Peer.tempid(&quot;:db.part/db&quot;),
         &quot;:db.install/_partition&quot;, &quot;:db.part/db&quot;),
</code></pre>

<p>&hellip; except that the information is now installed internally in Datomic as partition data instead of as attribute data.</p>

<p>Partition examples with Molecule:</p>

<ul>
<li><a href="https://github.com/scalamolecule/molecule/blob/master/coretests/src/main/scala/molecule/coretests/schemaDef/schema/PartitionTestDefinition.scala">partitioned schema definition</a></li>
<li><a href="https://github.com/scalamolecule/molecule/blob/master/coretests/src/test/scala/molecule/coretests/schemaDef/partition.scala">partition tests</a></li>
</ul>

<p>More about <a href="http://docs.datomic.com/indexes.html#sec-3">partitions in Datomic</a>.</p>

<h2 id="create-new-datomic-database">Create new Datomic database</h2>

<p>Now we can simply pass the generated raw transaction data to Datomic in order to create our partitions/schema:</p>

<pre><code class="language-scala">implicit val conn = recreateDbFrom(SeattleSchema)
</code></pre>

<p>The returned connection to the database is saved in an implicit val. Molecule method calls need an implicit database connection
to be in scope so our above implicit conn object will make it possible to create and operate on molecules in the following code.</p>

<h2 id="managing-databases">Managing databases</h2>

<p>Datomic databases are created with a database name so that we can later refer to a spedific database. In the above creation example,
a random database name was created which is convenient for testing purposes.</p>

<p>For durable databases we use a database name:</p>

<pre><code class="language-scala">// Create new database with identifier
implicit val conn = recreateDbFrom(SeattleSchema, &quot;myDatabase&quot;)
</code></pre>

<p>Then we can later - in another scope - establish a new connection to the existing database:</p>

<pre><code class="language-scala">// Create connection to the database 'myDatabase' 
implicit val conn = Conn(&quot;myDatabase&quot;)
</code></pre>

<h2 id="protocols">Protocols</h2>

<p>We can also supply a protocol like &lsquo;mem&rsquo; for in-memory db, or &lsquo;dev&rsquo; for a development db saved on local disk etc.</p>

<pre><code class="language-scala">// Create new database with identifier as an in-memory database
implicit val conn = recreateDbFrom(SeattleSchema, &quot;myDatabase&quot;, &quot;mem&quot;)
</code></pre>

<p>For more information on
db creation, please see the <a href="http://docs.datomic.com/getting-started/connect-to-a-database.html">Datomic documentation</a>.</p>

<h3 id="next">Next&hellip;</h3>

<p>Since Molecule is in its early development (although started in 2014) a more thorough Molecule database management API hasn&rsquo;t been
created yet. It is though no problem to access Datomic directly for this purpose in the meanwhile. The <code>recreateDbFrom</code> method
is for instance just a wrapper around the following code:</p>

<pre><code class="language-scala">import datomic._

// Setup database
val uri = &quot;datomic:mem://seattle&quot;
Peer.deleteDatabase(uri)
Peer.createDatabase(uri)
implicit val conn = Conn(Peer.connect(uri))

// Transact partitions/schema
conn.transact(SeattleSchema.partitions) // Optional
conn.transact(SeattleSchema.namespaces)
</code></pre>

<p>So if you need more functionality than currently provided in Molecule you can simply use the <a href="http://docs.datomic.com/javadoc/index.html">datomic API</a> and
likely methods of the <a href="http://docs.datomic.com/javadoc/datomic/Peer.html">Peer</a>. Or you can file an
<a href="https://github.com/scalamolecule/molecule/issues">issue</a> or send a <a href="https://github.com/scalamolecule/molecule/pulls">pull request</a> :-)</p>

</div>

<div class="col-sm-2 column" style="padding-left:20px;padding-top:22px;padding-right: 0px;">
  <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm ">

  <div style="position:absolute;top: -36px; left: 0px;">
    
    <a class="navigation-control up" href="/docs/schema" style="position:absolute; top:0px; left: 56px">
      <span class="glyphicon glyphicon-chevron-up"></span>
    </a>
    
    
    <a class="navigation-control left" href="/docs/schema" style="position:absolute; top: 15px; left: 20px">
      <span class="glyphicon glyphicon-chevron-left"></span>
    </a>
    
    
    <a class="navigation-control right" href="/docs/attributes" style="position:absolute; top: 15px; left: 89px">
      <span class="glyphicon glyphicon-chevron-right"></span>
    </a>
    
    
    <a class="navigation-control right" href="/docs/attributes" style="position:absolute; top: 30px; left: 54px;">
      <span class="glyphicon glyphicon-chevron-down"></span>
    </a>
    
  </div>

  <ul class="bs-docs-sidenav">
    
    
    
    
    <li><a href="/docs/">Documentation</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/documentation/introduction/">Introduction</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/getting-started/">Getting started</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/getting-started/setup/">Setup</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/schema/">Schema</a></li>
    
    <ul class="level2">
      
      <li class="active"><b>Transaction</b></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/attributes/">Attributes</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/attributes/basics/">Basics</a></li>
      
      
      
      <li><a href="/docs/attributes/modes/">Mandatory/Tacet/Optional</a></li>
      
      
      
      <li><a href="/docs/attributes/mapped/">Map attributes</a></li>
      
      
      
      <li><a href="/docs/attributes/expressions/">Expressions</a></li>
      
      
      
      <li><a href="/docs/attributes/aggregates/">Aggregates</a></li>
      
      
      
      <li><a href="/docs/attributes/parameterized/">Parameterized</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/entities/">Entities</a></li>
    
    
    
    
    <li><a href="/docs/relationships/">Relationships</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/relationships/card-one/">Cardinality one</a></li>
      
      
      
      <li><a href="/docs/relationships/card-many/">Cardinality many</a></li>
      
      
      
      <li><a href="/docs/relationships/composites/">Composites</a></li>
      
      
      
      <li><a href="/docs/relationships/bidirectional/">Bidirectional</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/crud/">CRUD</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/crud/save/">Save</a></li>
      
      
      
      <li><a href="/docs/crud/insert/">Insert</a></li>
      
      
      
      <li><a href="/docs/crud/get/">Get</a></li>
      
      
      
      <li><a href="/docs/crud/getjson/">Get Json</a></li>
      
      
      
      <li><a href="/docs/crud/update/">Update</a></li>
      
      
      
      <li><a href="/docs/crud/retract/">Retract</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/transactions/">Transactions</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/transactions/tx-meta-data/">Tx meta data</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/time/">Time</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/time/asof-since/">AsOf/Since</a></li>
      
      
      
      <li><a href="/docs/time/history/">History</a></li>
      
      
      
      <li><a href="/docs/time/with/">With</a></li>
      
      
      
      <li><a href="/docs/time/testing/">Testing</a></li>
      
      
    </ul>
    
    
    
    
    
  </ul>
</nav>
</div>

     
  </div> 
</div> 
<div class="push"></div>
</div> 

<footer class="bs-docs-footer">

  <div class="container">
    <ul class="bs-docs-footer-links">
      <li style="vertical-align: top; margin-top: 0px;"><a href="/front/"><img src="/img/logo/MoleculeLogo200.png" alt=""></a></li>
      <li><a href="https://github.com/scalamolecule/molecule">GitHub</a></li>
      <li><a href="https://github.com/scalamolecule/molecule-docs">GitHub-docs</a></li>
      <li><a href="https://groups.google.com/forum/#!forum/molecule-dsl">Forum</a></li>
      <li><a href="/about/">About</a></li>
      <li><a href="/credits/">Credits</a></li>
    </ul>
    <p>Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="license">Apache License 2.0</a></p>
  </div>
</footer>


<script type="text/javascript" src="/js/jquery-1.11.2.min.js"></script>



<script type="text/javascript" src="/js/bootstrap.min.js"></script>



<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript" src="/js/scripts.js"></script>




<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2787756-3', 'auto');
  ga('send', 'pageview');
</script>
    
</body>
</html>
