<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link href='http://fonts.googleapis.com/css?family=Merriweather+Sans:400,300,300italic,400italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
  <title>Transactions</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/highlight/styles/solarized_light.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="/vendor/font-awesome/css/font-awesome.min.css">
  <link href="/css/style.css" rel="stylesheet">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="/img/apple-touch-icon-57-precomposed.png">
  <link rel="shortcut icon" href="/img/favicon.png">
  <link href="http://scalamolecule.org/docs/transactions/index.xml" rel="alternate" type="application/rss+xml" title="Molecule" />
</head>
<body>
<div class="wrapper">
<div class="container" style="padding-top:20px">
  <div class="col-md-12 column" style="padding-left:0px; margin-bottom:15px">
    <div class="col-md-12 column" style="padding-left:0px;height:50px;">

    <ul class="nav nav-pills">
      <li><a href="/" style="padding-left: 6px; padding-right: 13px; vertical-align: top; margin-top: 0px;"><img src="/img/logo/MoleculeLogo600.png" alt="" width="200"></a></li>
      
      <li class="dropdown ">
        <a data-toggle="dropdown" href="/compare/" target="_top" onclick="javascript:top.location = '\/compare\/';return true;">Compare</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="/compare/datomic/">Datomic</a></li>
            <li class="dropdown-submenu">
              <a href="/compare/sql/">SQL</a>
              <ul class="dropdown-menu">
                <li><a href="/compare/sql/slick/">Slick</a></li>
              </ul>
            </li>
            <li><a href="/compare/gremlin/">Gremlin</a></li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="/resources/" target="_top" onclick="javascript:top.location = '\/resources\/';return true;">Resources</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li class="dropdown-submenu">
              <a href="/resources/tutorials/">Tutorials</a>
              <ul class="dropdown-menu">
                <li><a href="/resources/tutorials/seattle/">Seattle</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/resources/videos/">Videos</a>
              <ul class="dropdown-menu">
                <li><a href="/resources/videos/2017-04-25_marc_grue/">Molecule presentation</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown active">
        <a data-toggle="dropdown" href="/docs/" target="_top" onclick="javascript:top.location = '\/docs\/';return true;">Docs</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li class="dropdown-submenu">
              <a href="/docs/">Documentation</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/documentation/introduction/">Introduction</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/getting-started/">Getting started</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/getting-started/setup/">Setup</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/schema/">Schema</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/schema/transaction/">Transaction</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/attributes/">Attributes</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/attributes/basics/">Basics</a></li>
                <li><a href="/docs/attributes/modes/">Mandatory/Tacet/Optional</a></li>
                <li><a href="/docs/attributes/mapped/">Map attributes</a></li>
                <li><a href="/docs/attributes/expressions/">Expressions</a></li>
                <li><a href="/docs/attributes/aggregates/">Aggregates</a></li>
                <li><a href="/docs/attributes/parameterized/">Parameterized</a></li>
              </ul>
            </li>
            <li><a href="/docs/entities/">Entities</a></li>
            <li class="dropdown-submenu">
              <a href="/docs/relationships/">Relationships</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/relationships/card-one/">Cardinality one</a></li>
                <li><a href="/docs/relationships/card-many/">Cardinality many</a></li>
                <li><a href="/docs/relationships/composites/">Composites</a></li>
                <li><a href="/docs/relationships/bidirectional/">Bidirectional</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/crud/">CRUD</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/crud/save/">Save</a></li>
                <li><a href="/docs/crud/insert/">Insert</a></li>
                <li><a href="/docs/crud/get/">Get</a></li>
                <li><a href="/docs/crud/getjson/">Get Json</a></li>
                <li><a href="/docs/crud/update/">Update</a></li>
                <li><a href="/docs/crud/retract/">Retract</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/transactions/">Transactions</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/transactions/tx-meta-data/">Tx meta data</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
              <a href="/docs/time/">Time</a>
              <ul class="dropdown-menu">
                <li><a href="/docs/time/asof-since/">AsOf/Since</a></li>
                <li><a href="/docs/time/history/">History</a></li>
                <li><a href="/docs/time/with/">With</a></li>
                <li><a href="/docs/time/testing/">Testing</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="/dev/" target="_top" onclick="javascript:top.location = '\/dev\/';return true;">Dev</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
            <li><a href="/dev/">Developer</a></li>
            <li><a href="/dev/boilerplate/">Boilerplate</a></li>
            <li><a href="/dev/transformation/">Transformation</a></li>
        </ul>
      </li>
      <li class="dropdown ">
        <a data-toggle="dropdown" href="/community/" target="_top" onclick="javascript:top.location = '\/community\/';return true;">Community</a>
          <ul class="dropdown-menu level1" role="menu" aria-labelledby="dropdownMenu">
        </ul>
      </li>
      <li>
        <div  style="padding-left:14px;padding-top:19px;height:24px;float:right;">
            <a href="https://github.com/scalamolecule/molecule" class="github-button" data-icon="octicon-star">Github</a>
            
          </div>
      </li>
    </ul>

</div>
  </div> 

<div class="col-sm-10 column" style="padding-left:8px;">
	

<h1 id="transactions">Transactions</h1>

<p><a href="https://github.com/scalamolecule/molecule/blob/master/coretests/src/test/scala/molecule/coretests/transaction/TransactionData.scala">Transaction tests</a> and
<a href="https://github.com/scalamolecule/molecule/blob/master/coretests/src/test/scala/molecule/coretests/time/GetHistory.scala">History tests</a></p>

<p>All assertions and retractions in Datomic happen within a transaction that guarantees ACID consistency. Along with the domain data
involved, Datomic also automatically asserts a timestamp as part of a created Transaction entity for that transaction.</p>

<p>Say that we create a new person with entity id <code>e5</code>:</p>

<pre><code class="language-scala">val e5 = Person.name(&quot;Fred&quot;).likes(&quot;pizza&quot;).save.eid
</code></pre>

<p>Then the following assertions are made:</p>

<p><img src="/img/transactions/1.jpg" alt="" /></p>

<p>The 4th column of the quintuplets is the entity id of the transaction where the fact was asserted or retracted. In this
case the two facts about Fred was asserted in transaction <code>tx4</code>. <code>tx4</code> is an entity id (<code>Long</code>) exactly as the entity id of fred <code>e5</code>.</p>

<p>The time of the transaction <code>date1</code> (<code>java.util.Date</code>) is asserted with the transaction entity id <code>tx4</code>
as its entity id. And since that timestamp fact is also part of the same transaction <code>tx4</code> is also the transaction value (4th column)
for that fact.</p>

<h3 id="transaction-entity-id-tx">Transaction entity id <code>tx</code></h3>

<p>Since the transaction is itself an entity exactly as any other entity we can query it as we query our own domain data.</p>

<p>Molecule offers a few generic attributes that makes it easy to access transaction data. In our example we could find the
transaction entity id of the assertion of Freds <code>name</code> by adding the generic attribute <code>tx</code> right after the <code>name_</code> attribute (that we
have made tacit with the underscore since we&rsquo;re not interested in value &ldquo;Fred&rdquo;):</p>

<p><em>&ldquo;In what transaction was Freds name asserted?&rdquo;</em></p>

<pre><code class="language-scala">Person(e5).name_.tx.get.head === tx4  // 13194139534340L
</code></pre>

<p>The <code>tx</code> attribute gets the 4th quintuplet value of its preceeding attribute in a molecule. We can see that <code>name</code> of entity
<code>e5</code> (Fred) was asserted in transaction <code>tx4</code> since the value <code>tx4</code> was saved as the <code>name</code> quintuplet&rsquo;s 4th value.</p>

<h3 id="transaction-value-t">Transaction value <code>t</code></h3>

<p>Alternatively we can get a transaction value <code>t</code></p>

<pre><code class="language-scala">Person(e5).name_.t.get.head === t4  // 1028L
</code></pre>

<h3 id="transaction-time-txinstant">Transaction time <code>txInstant</code></h3>

<p>With the transaction entity available we can then also get to the value of the timestamp fact of that transaction entity. For
 convenience Molecule has a generic <code>txIntstant</code> to lookup the timestamp which is a <code>date.util.Date</code>:</p>

<p><em>&ldquo;When was Freds name asserted?&rdquo;</em></p>

<pre><code class="language-scala">Person(e5).name_.txInstant.get.head === date1  // Tue Apr 26 18:35:41
</code></pre>

<h3 id="transaction-data-per-attribute">Transaction data per attribute</h3>

<p>Since each fact of an entity could have been stated in different transactions, transaction data is always tied to only one
 attribute.</p>

<p>Say for instance that we assert Fred&rsquo;s <code>age</code> in another transaction <code>tx5</code>, then we could subsequently get the
 two transactions involved:</p>

<p><em>&ldquo;Was Fred&rsquo;s name and age asserted in the same transaction?&rdquo;</em></p>

<pre><code class="language-scala">// Second transaction
val tx5 = Person(e5).age(38).update.tx

// Retrieve transactions of multiple attributes
Person(e5).name_.tx.age_.tx.get.head === (tx4, tx5)

// No, name and age were asserted in different transactions
tx4 !== tx5
</code></pre>

<p>Likewise we could ask</p>

<p><em>&ldquo;At what time was Fred&rsquo;s name and age asserted&rdquo;</em></p>

<pre><code class="language-scala">Person(e5).name_.txInstant.age_.txInstant.get.head === (date1, date2)

// Fred's name was asserted before his age
date1.before(date2) === true
</code></pre>

<h3 id="next">Next</h3>

<p><a href="/docs/transactions/tx-meta-data">Transaction meta data&hellip;</a></p>

</div>

<div class="col-sm-2 column" style="padding-left:20px;padding-top:22px;padding-right: 0px;">
  <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm ">

  <div style="position:absolute;top: -36px; left: 0px;">
    
    <a class="navigation-control up" href="/docs/crud" style="position:absolute; top:0px; left: 56px">
      <span class="glyphicon glyphicon-chevron-up"></span>
    </a>
    
    
    <a class="navigation-control left" href="/docs/crud/retract" style="position:absolute; top: 15px; left: 20px">
      <span class="glyphicon glyphicon-chevron-left"></span>
    </a>
    
    
    <a class="navigation-control right" href="/docs/transactions/tx-meta-data" style="position:absolute; top: 15px; left: 89px">
      <span class="glyphicon glyphicon-chevron-right"></span>
    </a>
    
    
    <a class="navigation-control right" href="/docs/time" style="position:absolute; top: 30px; left: 54px;">
      <span class="glyphicon glyphicon-chevron-down"></span>
    </a>
    
  </div>

  <ul class="bs-docs-sidenav">
    
    
    
    
    <li><a href="/docs/">Documentation</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/documentation/introduction/">Introduction</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/getting-started/">Getting started</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/getting-started/setup/">Setup</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/schema/">Schema</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/schema/transaction/">Transaction</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/attributes/">Attributes</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/attributes/basics/">Basics</a></li>
      
      
      
      <li><a href="/docs/attributes/modes/">Mandatory/Tacet/Optional</a></li>
      
      
      
      <li><a href="/docs/attributes/mapped/">Map attributes</a></li>
      
      
      
      <li><a href="/docs/attributes/expressions/">Expressions</a></li>
      
      
      
      <li><a href="/docs/attributes/aggregates/">Aggregates</a></li>
      
      
      
      <li><a href="/docs/attributes/parameterized/">Parameterized</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/entities/">Entities</a></li>
    
    
    
    
    <li><a href="/docs/relationships/">Relationships</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/relationships/card-one/">Cardinality one</a></li>
      
      
      
      <li><a href="/docs/relationships/card-many/">Cardinality many</a></li>
      
      
      
      <li><a href="/docs/relationships/composites/">Composites</a></li>
      
      
      
      <li><a href="/docs/relationships/bidirectional/">Bidirectional</a></li>
      
      
    </ul>
    
    
    
    
    <li><a href="/docs/crud/">CRUD</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/crud/save/">Save</a></li>
      
      
      
      <li><a href="/docs/crud/insert/">Insert</a></li>
      
      
      
      <li><a href="/docs/crud/get/">Get</a></li>
      
      
      
      <li><a href="/docs/crud/getjson/">Get Json</a></li>
      
      
      
      <li><a href="/docs/crud/update/">Update</a></li>
      
      
      
      <li><a href="/docs/crud/retract/">Retract</a></li>
      
      
    </ul>
    
    
    
    
    <li class="active"><b>Transactions</b></li>
    
    <ul class="level2">
      <li><a href="/docs/transactions/tx-meta-data/">Tx meta data</a></li>
      
    </ul>
    
    
    
    
    <li><a href="/docs/time/">Time</a></li>
    
    <ul class="level2">
      
      <li><a href="/docs/time/asof-since/">AsOf/Since</a></li>
      
      
      
      <li><a href="/docs/time/history/">History</a></li>
      
      
      
      <li><a href="/docs/time/with/">With</a></li>
      
      
      
      <li><a href="/docs/time/testing/">Testing</a></li>
      
      
    </ul>
    
    
    
    
    
  </ul>
</nav>
</div>

     
  </div> 
</div> 
<div class="push"></div>
</div> 

<footer class="bs-docs-footer">

  <div class="container">
    <ul class="bs-docs-footer-links">
      <li style="vertical-align: top; margin-top: 0px;"><a href="/front/"><img src="/img/logo/MoleculeLogo200.png" alt=""></a></li>
      <li><a href="https://github.com/scalamolecule/molecule">GitHub</a></li>
      <li><a href="https://github.com/scalamolecule/molecule-docs">GitHub-docs</a></li>
      <li><a href="https://groups.google.com/forum/#!forum/molecule-dsl">Forum</a></li>
      <li><a href="/about/">About</a></li>
      <li><a href="/credits/">Credits</a></li>
    </ul>
    <p>Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="license">Apache License 2.0</a></p>
  </div>
</footer>


<script type="text/javascript" src="/js/jquery-1.11.2.min.js"></script>



<script type="text/javascript" src="/js/bootstrap.min.js"></script>



<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript" src="/js/scripts.js"></script>




<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2787756-3', 'auto');
  ga('send', 'pageview');
</script>
    
</body>
</html>
