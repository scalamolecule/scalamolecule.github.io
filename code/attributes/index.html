<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"/>
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic,500,600,700,700italic,800,800italic'
          rel='stylesheet' type='text/css'>
    <title>Attributes</title>
    <link href="../../css/bootstrap.min.css" rel="stylesheet">



    <link href="../../css/highlight/styles/solarized_light.css" rel="stylesheet"/>
    <link href="../../css/syntax-custom.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../../vendor/font-awesome/css/font-awesome.min.css">

    <link href="../../css/style.css" rel="stylesheet">

    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../img/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../img/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../img/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../../img/apple-touch-icon-57-precomposed.png">

    
    
</head>
<body data-spy="scroll" data-target="#sidebar" data-offset="110">
<header class="bs-docs-header">

    <nav class="navbar navbar-inverse">
        <div class="container-fluid" style="max-width:1170px;padding-top:3px">
            
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="../../" style="padding-left: 6px; padding-right: 13px;"><img src="../../img/logo/MoleculeLogo150.png"></a>
            </div>

            
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    
                    
                        
                            <li class="dropdown">
                                <a href="../../intro/" target="_top">Intro</a>
                            </li>
                        
                    
                        
                            <li class="dropdown">
                                <a href="../../setup/" target="_top">Setup</a>
                            </li>
                        
                    
                        
                            <li class="active">
                                <a href="../../code/" target="_top">Code</a>
                                <div></div>
                            </li>
                        
                    
                        
                            <li class="dropdown">
                                <a href="../../dev/" target="_top">Dev</a>
                            </li>
                        
                    
                        
                            <li class="dropdown">
                                <a href="../../community/" target="_top">Community</a>
                            </li>
                        
                    
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://javadoc.io/doc/org.scalamolecule/molecule_2.13/latest/index.html" target="_blank" style="">Docs</a></li>
                    <li><a href="../../changelog" style="">v0.24.0</a></li>
                    <li><a href="https://github.com/scalamolecule/molecule" target="_blank">
                        <img src="../../vendor/GitHub-Mark/PNG/GitHub-Mark-Light-32px.png"
                             style="margin-top:-4px;padding-left:15px;opacity:0.6;width:42px;">
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>

</header>

<div class="wrapper">

<div class="container-fluid" style="max-width:1170px">

    <div class="col-sm-10 " style="padding-left:8px;">
        <h1 id="attributes">Attributes</h1>
<p>Molecules are built by chaining attributes together with the builder pattern.</p>
<p>Molecule then transforms the constructed molecule to a query string at compile time. Molecules can be constructed explicitly with the <code>m</code> method. But generally the implicit call is used.</p>
<p>We could for instance build a molecule representing the data structure of Persons with name, age and gender Attributes:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// Explicit `m` macro call
</span><span class="c1"></span><span class="n">m</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">gender</span><span class="o">).</span><span class="n">get</span>

<span class="c1">// Implicit `m` macro call
</span><span class="c1"></span><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">gender</span><span class="o">.</span><span class="n">get</span>
</code></pre></div><p>The fundamental building blocks are Namespaces like <code>Person</code> and Attributes like <code>name</code>, <code>age</code> and <code>gender</code>. Namespaces are simply prefixes to Attribute names to avoid name clashes and to group our Attributes in meaningful ways according to our domain.</p>
<p>As you see we start our molecule from some Namespace and then build on Attribute by Attribute.</p>
<h3 id="molecule-max-size">Molecule max size</h3>
<p>The size of molecules are limited to Scala&rsquo;s arity limit of 22 for tuples.</p>
<p>But we can create a <a href="../../code/relationships/#composite-molecules">composite molecule</a> with up to 22 x 22 = 484 attributes!</p>
<h3 id="cardinality">Cardinality</h3>
<p>The attributes <code>name</code>, <code>age</code> and <code>gender</code> that we saw above are typical cardinality-one attributes each with one value.</p>
<p>Datomic also has cardinality-many attributes that have a <code>Set</code> of values. This means that the same value cannot be saved multiple times, or that only unique values are saved. An example could be a cardinality-many attribute <code>hobbies</code> of a <code>Person</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">hobbies</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">head</span> <span class="o">===</span> <span class="o">(</span><span class="s">&#34;John&#34;</span><span class="o">,</span> <span class="nc">Set</span><span class="o">(</span><span class="s">&#34;Trains&#34;</span><span class="o">,</span> <span class="s">&#34;Chess&#34;</span><span class="o">))</span>
</code></pre></div><p>In the <a href="../../code/transactions/#update">Update</a> section of CRUD we will see how multiple values are managed with Molecule.</p>
<h2 id="3-attribute-modes">3 attribute modes</h2>
<h4 id="1-mandatory-attr">1. Mandatory <code>attr</code></h4>
<p>When we use a molecule to query the Datomic database we ask for entities having all our Attributes associated with them.</p>
<p><em>Note that this is different from selecting rows from a sql table where you can also get null values back!</em></p>
<p>If for instance we have entities representing Persons in our data set that haven&rsquo;t got any age Attribute associated with them then this query will <em>not</em> return those entities:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">persons</span> <span class="k">=</span> <span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">get</span>
</code></pre></div><p>Basically we look for <strong>matches</strong> to our molecule data structure.</p>
<h4 id="2-tacit-attr_">2. Tacit <code>attr_</code></h4>
<p>Sometimes we want to grap entities that we <em>know</em> have certain attributes, but without returning those values. We call the un-returning attributes &ldquo;tacit attributes&rdquo;.</p>
<p>If for instance we wanted to find all names of Persons that have an age attribute set but we don&rsquo;t need to return those age values, then we can add an underscore <code>_</code> after the <code>age</code> Attribute:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">names</span> <span class="k">=</span> <span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">age_</span><span class="o">.</span><span class="n">get</span>
</code></pre></div><p>This will return names of person entities having both a name and age Attribute set. Note how the age values are no longer returned from the type signatures:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">persons</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">get</span>
<span class="k">val</span> <span class="n">names</span>  <span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>        <span class="k">=</span> <span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">age_</span><span class="o">.</span><span class="n">get</span>
</code></pre></div><p>This way we can switch on and off individual attributes from the result set without affecting the data structures we look for.</p>
<h4 id="3-optional-attr">3. Optional <code>attr$</code></h4>
<p>If an attribute value is only sometimes set, we can ask for it&rsquo;s optional value by adding a dollar sign <code>$</code> after the attribute:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">names</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>, <span class="kt">String</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">Person</span><span class="o">.</span><span class="n">firstName</span><span class="o">.</span><span class="n">middleName$</span><span class="o">.</span><span class="n">lastName</span><span class="o">.</span><span class="n">get</span>
</code></pre></div><p>That way we can get all person names with or without middleNames. As you can see from the return type, the middle name is wrapped in an <code>Option</code>.</p>
<h2 id="map-attributes">Map Attributes</h2>
<p>Mapped values can be saved with mapped attributes in Molecule. It&rsquo;s a special Molecule construct that makes it easy to save for instance multi-lingual data without having to create language-variations of each attribute. But they can also be used for any other key-value indexed data.</p>
<p>Say you want to save famous Persons names in multiple languages. Then you could use a mapString:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// In definition file
</span><span class="c1"></span><span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="n">mapString</span>
 
<span class="c1">// Insert mapped data
</span><span class="c1"></span><span class="nc">Person</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">insert</span><span class="o">(</span>
  <span class="mi">1</span><span class="o">,</span> 
  <span class="nc">Map</span><span class="o">(</span>
    <span class="s">&#34;en&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Dmitri Shostakovich&#34;</span><span class="o">,</span>
    <span class="s">&#34;de&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Dmitri Schostakowitsch&#34;</span><span class="o">,</span>
    <span class="s">&#34;fr&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Dmitri Chostakovitch&#34;</span><span class="o">,</span>
    <span class="s">&#34;es&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Dmitri Shostakóvich&#34;</span>
  <span class="o">)</span>
<span class="o">)</span>

<span class="c1">// Retrieve mapped data
</span><span class="c1"></span><span class="nc">Person</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">head</span> <span class="o">===</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> 
  <span class="nc">Map</span><span class="o">(</span>
    <span class="s">&#34;en&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Dmitri Shostakovich&#34;</span><span class="o">,</span>
    <span class="s">&#34;de&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Dmitri Schostakowitsch&#34;</span><span class="o">,</span>
    <span class="s">&#34;fr&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Dmitri Chostakovitch&#34;</span><span class="o">,</span>
    <span class="s">&#34;es&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Dmitri Shostakóvich&#34;</span>
  <span class="o">)</span>
<span class="o">)</span>
</code></pre></div><p>Molecule concatenates the key and value of each pair to one of several values of an underlying cardinality-many attribute. When data is then retrieved Molecule splits the concatenated string into a typed pair. This all happens automatically and let&rsquo;s us focus on their use in our code.</p>
<h2 id="expressions">Expressions</h2>
<h3 id="equality">Equality</h3>
<p>We can apply values to Attributes in order to filter the data structures we are looking for. We could for instance find people who like pizza:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">likes</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="s">&#34;pizza&#34;</span><span class="o">)</span>
</code></pre></div><p>or simply</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">likes</span><span class="o">(</span><span class="s">&#34;pizza&#34;</span><span class="o">)</span>
</code></pre></div><p>Since the applied value &ldquo;pizza&rdquo; ensures that the attributes returned has this value we will get redundant information back for the <code>likes</code> attribute (&ldquo;pizza&rdquo; is returned for all persons):</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">likes</span><span class="o">(</span><span class="s">&#34;pizza&#34;</span><span class="o">).</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="s">&#34;John&#34;</span><span class="o">,</span> <span class="s">&#34;pizza&#34;</span><span class="o">),</span>
  <span class="o">(</span><span class="s">&#34;Ben&#34;</span><span class="o">,</span> <span class="s">&#34;pizza&#34;</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div><p>This is an ideomatic place to use a tacit attribute <code>likes_</code> to say &ldquo;Give me names of persons that like pizza&rdquo; without returning the <code>likes</code> value &ldquo;pizza&rdquo; over and over again. Then we get a nice list of only the pizza likers:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">likes_</span><span class="o">(</span><span class="s">&#34;pizza&#34;</span><span class="o">).</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="s">&#34;John&#34;</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span>
<span class="o">)</span>
</code></pre></div><p><em>Note that since we get an arity-1 result back it is simply a list of those values.</em></p>
<p>We can apply OR-logic to find a selection of alternatives</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="mi">40</span> <span class="n">or</span> <span class="mi">41</span> <span class="n">or</span> <span class="mi">42</span><span class="o">)</span>
<span class="c1">// .. same as
</span><span class="c1"></span><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span> <span class="mi">42</span><span class="o">)</span>
<span class="c1">// .. same as
</span><span class="c1"></span><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span> <span class="mi">42</span><span class="o">))</span>
</code></pre></div><h3 id="fulltext-search">Fulltext search</h3>
<p>If we add the <code>fulltext</code> option to a String attribute definition Datomic will index the text strings saved so that we can do fulltext searches across all values. We could for instance search for Community names containing the word &ldquo;Town&rdquo; in their name:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Community</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="s">&#34;Town&#34;</span><span class="o">)</span>
</code></pre></div><p>Note that only full words are considered, so &ldquo;Tow&rdquo; won&rsquo;t match. Searches are case-insensitive.</p>
<p>Also, the following common words are not considered:</p>
<pre><code>&quot;a&quot;, &quot;an&quot;, &quot;and&quot;, &quot;are&quot;, &quot;as&quot;, &quot;at&quot;, &quot;be&quot;, &quot;but&quot;, &quot;by&quot;,
&quot;for&quot;, &quot;if&quot;, &quot;in&quot;, &quot;into&quot;, &quot;is&quot;, &quot;it&quot;,
&quot;no&quot;, &quot;not&quot;, &quot;of&quot;, &quot;on&quot;, &quot;or&quot;, &quot;such&quot;,
&quot;that&quot;, &quot;the&quot;, &quot;their&quot;, &quot;then&quot;, &quot;there&quot;, &quot;these&quot;,
&quot;they&quot;, &quot;this&quot;, &quot;to&quot;, &quot;was&quot;, &quot;will&quot;, &quot;with&quot;
</code></pre><h3 id="negation">Negation</h3>
<p>We can exclude a certain attribute value like in &ldquo;Persons that are not 42 years old&rdquo;:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.!=(</span><span class="mi">42</span><span class="o">)</span>
<span class="c1">// or
</span><span class="c1"></span><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">not</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
</code></pre></div><p>Negate multiple values</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.!=(</span><span class="mi">40</span> <span class="n">or</span> <span class="mi">41</span> <span class="n">or</span> <span class="mi">42</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.!=(</span><span class="mi">40</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span> <span class="mi">42</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.!=(</span><span class="nc">List</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span> <span class="mi">42</span><span class="o">))</span>
</code></pre></div><h3 id="comparison">Comparison</h3>
<p>We can filer attribute values that satisfy comparison expressions:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.&lt;(</span><span class="mi">42</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.&gt;(</span><span class="mi">42</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.&lt;=(</span><span class="mi">42</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.&gt;=(</span><span class="mi">42</span><span class="o">)</span>
</code></pre></div><p>Comparison of all types are performed with java&rsquo;s <code>compareTo</code> method. Text strings can for instance also be sorted by a letter:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Community</span><span class="o">.</span><span class="n">name</span><span class="o">.&lt;(</span><span class="s">&#34;C&#34;</span><span class="o">).</span><span class="n">get</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="s">&#34;ArtsWest&#34;</span><span class="o">,</span> <span class="s">&#34;All About South Park&#34;</span><span class="o">,</span> <span class="s">&#34;Ballard Neighbor Connection&#34;</span><span class="o">)</span>
</code></pre></div><h3 id="null">Null</h3>
<p>We can look for non-asserted attributes (Null values) as in &ldquo;Persons that have no age asserted&rdquo; by applying an empty value to an attribute:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">age_</span><span class="o">()</span> <span class="o">===</span> <span class="c1">// all persons where age hasn&#39;t been asserted
</span></code></pre></div><p>Note that the <code>age_</code> attribute has to be tacit (with an underscore) since we naturally can&rsquo;t return missing values.</p>
<h3 id="applying-variables">Applying variables</h3>
<p>Even though Molecule introspects molecule constructions at compile time we can still use (runtime) variables for our expressions:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">youngAge</span> <span class="k">=</span> <span class="mi">25</span>
<span class="k">val</span> <span class="n">goodAge</span> <span class="k">=</span> <span class="mi">42</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">goodAge</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.&gt;(</span><span class="n">goodAge</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.&lt;=(</span><span class="n">goodAge</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.&gt;=(</span><span class="n">goodAge</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.!=(</span><span class="n">goodAge</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">.!=(</span><span class="n">youngAge</span> <span class="n">or</span> <span class="n">goodAge</span><span class="o">)</span>
</code></pre></div><p>Technically, Molecule saves the <code>TermName</code> like &lsquo;goodAge&rsquo; of the variable for later resolution at runtime so that we can freely use variables in our expressions.</p>
<p>For now Molecule can&rsquo;t though evaluate arbitrary applied expressions like this one:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">birthday</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Date</span><span class="o">(</span><span class="s">&#34;2017-05-10&#34;</span><span class="o">))</span>
</code></pre></div><p>In this case we could instead apply the expression result to a variable and use that in the molecule:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">date</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Date</span><span class="o">(</span><span class="s">&#34;2017-05-10&#34;</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">.</span><span class="n">birthday</span><span class="o">(</span><span class="n">date</span><span class="o">)</span>
</code></pre></div><h2 id="aggregates">Aggregates</h2>
<p>Molecule wraps Datomic&rsquo;s native aggregate functions by applying special aggregate keyword objects to the attribute we want to aggregate on.</p>
<p>Aggregate functions either return a single value or a collection of values:</p>
<h3 id="aggregates-returning-a-single-value">Aggregates returning a single value</h3>
<h4 id="minmax">min/max</h4>
<p>Applying the <code>min</code> or <code>max</code> aggregate keyword object as a value to the <code>age</code> attribute returns the lowest/highest ages.</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">min</span><span class="o">)</span> <span class="c1">// lowest age
</span><span class="c1"></span><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">max</span><span class="o">)</span> <span class="c1">// highest age
</span></code></pre></div><p><code>min</code>/<code>max</code> supports all attribute types.</p>
<h4 id="sum">sum</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">sum</span><span class="o">)</span> <span class="c1">// sum of all ages
</span></code></pre></div><h4 id="count">count</h4>
<p>Count the total number of entities with an asserted <code>age</code> value (not to be confused with <code>sum</code>).</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">count</span><span class="o">)</span> <span class="c1">// count of all persons with an age (not the sum of ages)
</span></code></pre></div><h4 id="countdistinct">countDistinct</h4>
<p>Count the total number of entities with asserted <em>unique</em> <code>age</code> values (not to be confused with <code>sum</code>).</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">countDistinct</span><span class="o">)</span>  <span class="c1">// count of unique ages
</span></code></pre></div><h4 id="avg">avg</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">avg</span><span class="o">)</span> <span class="c1">// average of all ages
</span></code></pre></div><h4 id="median">median</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">median</span><span class="o">)</span> <span class="c1">// median of all ages
</span></code></pre></div><h4 id="variance">variance</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">variance</span><span class="o">)</span> <span class="c1">// variance of all ages
</span></code></pre></div><h4 id="stddev">stddev</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">stddev</span><span class="o">)</span> <span class="c1">// standard deviation of all ages
</span></code></pre></div><h3 id="aggregates-returning-collections-of-values">Aggregates returning collections of values</h3>
<h4 id="distinct">distinct</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">distinct</span><span class="o">)</span> <span class="c1">// distinct ages
</span></code></pre></div><h4 id="minn">min(n)</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">min</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span> <span class="c1">// 3 lowest ages
</span></code></pre></div><h4 id="maxn">max(n)</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">max</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span> <span class="c1">// 3 highest ages
</span></code></pre></div><h4 id="randn">rand(n)</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">rand</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span> <span class="c1">// 3 random persons (with potential for duplicates)
</span></code></pre></div><h4 id="samplen">sample(n)</h4>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">age</span><span class="o">(</span><span class="n">sample</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span> <span class="c1">// 3 sample persons (without duplicates)
</span></code></pre></div><h2 id="input-molecules">Input-molecules</h2>
<p>Molecules can be parameterized by applying the input placeholder <code>?</code> as a value to an attribute. The molecule then expects input for that attribute at runtime.</p>
<p>By assigning parameterized &ldquo;Input-molecules&rdquo; to variables we can re-use those variables to query for similar data structures where only some data part varies:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// 1 input parameter
</span><span class="c1"></span><span class="k">val</span> <span class="n">person</span> <span class="k">=</span> <span class="n">m</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">(?))</span>

<span class="k">val</span> <span class="n">john</span> <span class="k">=</span> <span class="n">person</span><span class="o">(</span><span class="s">&#34;John&#34;</span><span class="o">).</span><span class="n">get</span><span class="o">.</span><span class="n">head</span>
<span class="k">val</span> <span class="n">lisa</span> <span class="k">=</span> <span class="n">person</span><span class="o">(</span><span class="s">&#34;Lisa&#34;</span><span class="o">).</span><span class="n">get</span><span class="o">.</span><span class="n">head</span>
</code></pre></div><p>Of course more complex molecules would benefit even more from this approach.</p>
<h3 id="datomic-cache-and-optimization">Datomic cache and optimization</h3>
<p>Datomic caches and optimizes queries from input molecules so performance-wise it&rsquo;s a good idea to use them.</p>
<h3 id="parameterized-expressions">Parameterized expressions</h3>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">personName</span>  <span class="k">=</span> <span class="n">m</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">(?))</span>
<span class="k">val</span> <span class="n">johnOrLisas</span> <span class="k">=</span> <span class="n">personName</span><span class="o">(</span><span class="s">&#34;John&#34;</span> <span class="n">or</span> <span class="s">&#34;Lisa&#34;</span><span class="o">).</span><span class="n">get</span> <span class="c1">// OR
</span></code></pre></div><h3 id="multiple-parameters">Multiple parameters</h3>
<p>Molecules can have up to 3 <code>?</code> placeholder parameters.</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">person</span>      <span class="k">=</span> <span class="n">m</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">(?).</span><span class="n">age</span><span class="o">(?))</span>
<span class="k">val</span> <span class="n">john</span>        <span class="k">=</span> <span class="n">person</span><span class="o">(</span><span class="s">&#34;John&#34;</span> <span class="n">and</span> <span class="mi">24</span><span class="o">).</span><span class="n">get</span><span class="o">.</span><span class="n">head</span> <span class="c1">// AND
</span><span class="c1"></span><span class="k">val</span> <span class="n">johnOrJonas</span> <span class="k">=</span> <span class="n">person</span><span class="o">((</span><span class="s">&#34;John&#34;</span> <span class="n">and</span> <span class="mi">24</span><span class="o">)</span> <span class="n">or</span> <span class="o">(</span><span class="s">&#34;Lisa&#34;</span> <span class="n">and</span> <span class="mi">20</span><span class="o">)).</span><span class="n">get</span> <span class="c1">// AND/OR
</span></code></pre></div><h3 id="mix-parameterized-and-static-expressions">Mix parameterized and static expressions</h3>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">americansYoungerThan</span> <span class="k">=</span> <span class="n">m</span><span class="o">(</span><span class="nc">Person</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">age</span><span class="o">.&lt;(?).</span><span class="nc">Country</span><span class="o">.</span><span class="n">name</span><span class="o">(</span><span class="s">&#34;USA&#34;</span><span class="o">))</span>
<span class="k">val</span> <span class="n">americanKids</span>         <span class="k">=</span> <span class="n">americansYoungerThan</span><span class="o">(</span><span class="mi">13</span><span class="o">).</span><span class="n">get</span>
<span class="k">val</span> <span class="n">americanBabies</span>       <span class="k">=</span> <span class="n">americansYoungerThan</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">get</span>
</code></pre></div><h3 id="next">Next</h3>
<p><a href="../../code/relationships/">Relationships&hellip;</a></p>

    </div>

    <div class="col-sm-2" style="padding-left:24px;padding-right: 0px;position:sticky;top:115px">
        
<button type="button" id="sidebarCollapse" class="navbar-toggle collapsed" data-toggle="collapse" style="color:#bbb">
  <i class="glyphicon glyphicon-align-left"></i>
</button>

<nav class="bs-docs-sidebar" id="sidebar">
  <ul class="bs-docs-sidenav nav">
    
      

        
        
          
            <li><a href="../../code/">Overview</a></li>
          
          
        
          
            <li class="open"><a href="../../code/attributes/"><b>Attributes</b></a></li>
            
              <nav id="TableOfContents">
  <ul>
    <li></li>
    <li><a href="#3-attribute-modes">3 attribute modes</a></li>
    <li><a href="#map-attributes">Map Attributes</a></li>
    <li><a href="#expressions">Expressions</a></li>
    <li><a href="#aggregates">Aggregates</a></li>
    <li><a href="#input-molecules">Input-molecules</a></li>
  </ul>
</nav>
            
          
          
        
          
            <li><a href="../../code/relationships/">Relationships</a></li>
          
          
        
          
            <li><a href="../../code/transactions/">Transactions</a></li>
          
          
        
          
            <li><a href="../../code/transaction-functions/">Transaction Functions</a></li>
          
          
        
          
            <li><a href="../../code/time/">Time</a></li>
          
          
        
          
            <li><a href="../../code/generic/">Generic APIs</a></li>
          
          
        

      
    
  </ul>
</nav>
    </div>

</div> 

     
   
 


</div> 

<footer class="bs-docs-footer">

  <div class="container" style="font-size:15px">
    <ul class="bs-docs-footer-links">
      <li style="margin-top: 8px;"><a href="../../front/"><img src="../../img/logo/MoleculeLogo150.png" alt=""></a></li>
      <li><a href="https://github.com/scalamolecule/molecule">GitHub</a></li>
      <li><a href="https://github.com/scalamolecule/molecule-web">GitHub-web</a></li>
      <li><a href="https://gitter.im/scalamolecule/Lobby">Gitter</a></li>
      <li><a href="https://groups.google.com/forum/#!forum/molecule-dsl">Forum</a></li>
      <li><a href="../../about/">About</a></li>
      <li><a href="../../credits/">Credits</a></li>
      <li><a href="../../changelog">Changelog</a></li>
    </ul>
    <p>Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="license">Apache License 2.0</a></p>
  </div>
</footer>


<script type="text/javascript" src="../../js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="../../js/bootstrap.min.js"></script>


<script type="text/javascript" src="../../js/scripts.js"></script>
<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
<script src="../../js/copy-button.js"></script>
<script src="../../js/sidebar-collapser.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2787756-3', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
