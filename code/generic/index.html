<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"/>
    <title>Generic APIs</title>
    <link href="../../css/bootstrap.min.css" rel="stylesheet">



    <link href="../../css/highlight/styles/solarized_light.css" rel="stylesheet"/>
    <link href="../../css/syntax-custom.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../../vendor/font-awesome/css/font-awesome.min.css">

    <link href="../../css/style.css" rel="stylesheet">

    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../img/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../img/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../img/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../../img/apple-touch-icon-57-precomposed.png">

    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic,500,600,700,700italic,800,800italic' rel='stylesheet' type='text/css'>

    
    
</head>
<body data-spy="scroll" data-target="#sidebar" data-offset="110">
<header class="bs-docs-header">

    <nav class="navbar navbar-inverse">
        <div class="container-fluid" style="max-width:1170px;padding-top:3px">
            
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="../../" style="padding-left: 6px; padding-right: 13px;"><img src="../../img/logo/MoleculeLogo150.png"></a>
            </div>

            
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    
                    
                        
                            <li class="dropdown">
                                <a href="../../intro/" target="_top">Intro</a>
                            </li>
                        
                    
                        
                            <li class="dropdown">
                                <a href="../../setup/" target="_top">Setup</a>
                            </li>
                        
                    
                        
                            <li class="active">
                                <a href="../../code/" target="_top">Code</a>
                                <div></div>
                            </li>
                        
                    
                        
                            <li class="dropdown">
                                <a href="../../dev/" target="_top">Dev</a>
                            </li>
                        
                    
                        
                            <li class="dropdown">
                                <a href="../../community/" target="_top">Community</a>
                            </li>
                        
                    
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="https://javadoc.io/doc/org.scalamolecule/molecule_2.13/latest/index.html" target="_blank" style="">Docs</a></li>
                    <li><a href="../../changelog" style="">v0.25.1</a></li>
                    <li><a href="https://github.com/scalamolecule/molecule" target="_blank">
                        <img src="../../vendor/GitHub-Mark/PNG/GitHub-Mark-Light-32px.png"
                             style="margin-top:-4px;padding-left:15px;opacity:0.6;width:42px;">
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>

</header>

<div class="wrapper">

<div class="container-fluid" style="max-width:1170px">

    <div class="col-sm-10 " style="padding-left:8px;">
        <h1 id="generic-apis">Generic APIs</h1>
<p>Here, we&rsquo;ll walk through how Molecule provides access to Datomic&rsquo;s various generic interfaces and apis.</p>
<h2 id="entity-api">Entity API</h2>
<p>As we saw in <a href="../../intro/building-blocks/#entity">building blocks</a>, an entity can have attributes from multiple namespaces





<table class="table table-bordered">
<thead>
<tr>
<th style="text-align:center">Entity id</th>
<th style="text-align:left">Attribue</th>
<th style="text-align:left">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">johnId</td>
<td style="text-align:left">:Person/name</td>
<td style="text-align:left">&ldquo;John&rdquo;</td>
</tr>
<tr>
<td style="text-align:center">johnId</td>
<td style="text-align:left">:Person/likes</td>
<td style="text-align:left">&ldquo;pizza&rdquo;</td>
</tr>
<tr>
<td style="text-align:center">johnId</td>
<td style="text-align:left">:Person/age</td>
<td style="text-align:left">24</td>
</tr>
<tr>
<td style="text-align:center">johnId</td>
<td style="text-align:left">:Site/cat</td>
<td style="text-align:left">&ldquo;customer&rdquo;</td>
</tr>
</tbody>
</table>
</p>
<p>At runtime we can explore what attributes an entity has by calling <code>touch</code> directly on a <code>Long</code> entity id:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="n">johnId</span><span class="o">.</span><span class="n">touch</span> <span class="o">===</span> <span class="nc">Map</span><span class="o">(</span>
  <span class="s">&#34;:db/id&#34;</span> <span class="o">-&gt;</span> <span class="n">johnId</span><span class="o">,</span>
  <span class="s">&#34;:Person/name&#34;</span>  <span class="o">-&gt;</span> <span class="s">&#34;John&#34;</span><span class="o">,</span> 
  <span class="s">&#34;:Person/likes&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;pizza&#34;</span><span class="o">,</span> 
  <span class="s">&#34;:Person/age&#34;</span>   <span class="o">-&gt;</span> <span class="mi">24</span><span class="o">,</span> 
  <span class="s">&#34;:Site/cat&#34;</span>     <span class="o">-&gt;</span> <span class="s">&#34;customer&#34;</span>
<span class="o">)</span>
</code></pre></div><p>The <code>touch</code> method recursively retrieves referenced entities.</p>
<p>So if John had references, we migh want to apply a max depth level with <code>touch(&lt;maxLevel&gt;)</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="n">johnId</span><span class="o">.</span><span class="n">touchMax</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="o">===</span> <span class="nc">Map</span><span class="o">(</span>
  <span class="s">&#34;:db/id&#34;</span> <span class="o">-&gt;</span> <span class="n">johnId</span><span class="o">,</span>
  <span class="s">&#34;:Person/name&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;John&#34;</span>
  <span class="s">&#34;:Person/friends&#34;</span> <span class="o">-&gt;</span> <span class="nc">List</span><span class="o">(</span>
    <span class="nc">Map</span><span class="o">(</span>
      <span class="s">&#34;:db/id&#34;</span> <span class="o">-&gt;</span> <span class="n">lisaId</span><span class="o">,</span>
      <span class="s">&#34;:Person/name&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Lisa&#34;</span>
      <span class="s">&#34;:Person/friends&#34;</span> <span class="o">-&gt;</span> <span class="nc">List</span><span class="o">(</span>
        <span class="nc">Map</span><span class="o">(</span>
          <span class="s">&#34;:db/id&#34;</span> <span class="o">-&gt;</span> <span class="n">monaId</span><span class="o">,</span>
          <span class="s">&#34;:Person/name&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;Mona&#34;</span>
          <span class="s">&#34;:Person/friends&#34;</span> <span class="o">-&gt;</span> <span class="nc">Set</span><span class="o">(</span><span class="n">ids</span><span class="o">...)</span> <span class="c1">// Mona&#39;s friends (3 levels deep) only as ids - not attribute maps
</span><span class="c1"></span>        <span class="o">),</span>
        <span class="nc">Map</span><span class="o">(...)</span> <span class="c1">// + more friends of Lisa (2 levels deep)
</span><span class="c1"></span>      <span class="o">)</span>
    <span class="o">),</span>
    <span class="nc">Map</span><span class="o">(...)</span> <span class="c1">// + more friends of John (1 level deep)
</span><span class="c1"></span>  <span class="o">)</span>
<span class="o">)</span>
</code></pre></div><p>If we want to sort the key-value pairs we can also ask for a List with sorted pairs.</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="n">johnId</span><span class="o">.</span><span class="n">touchList</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="s">&#34;:db/id&#34;</span> <span class="o">-&gt;</span> <span class="n">johnId</span><span class="o">,</span>
  <span class="s">&#34;:Person/age&#34;</span>   <span class="o">-&gt;</span> <span class="mi">24</span><span class="o">,</span> 
  <span class="s">&#34;:Person/likes&#34;</span> <span class="o">-&gt;</span> <span class="s">&#34;pizza&#34;</span><span class="o">,</span> 
  <span class="s">&#34;:Person/name&#34;</span>  <span class="o">-&gt;</span> <span class="s">&#34;John&#34;</span><span class="o">,</span> 
  <span class="s">&#34;:Site/cat&#34;</span>     <span class="o">-&gt;</span> <span class="s">&#34;customer&#34;</span>
<span class="o">)</span>
</code></pre></div><p>The entity id pair <code>&quot;:db/id&quot; -&gt; johnId</code> is present for all touch calls and will always be first. The remaining pairs are hereafter sorted by key. Nested Lists likewise.</p>
<h4 id="testing">Testing</h4>
<p>When testing we also have a convenience method <code>touchListQuoted</code> that returns output that we can paste into tests so that we can avoid having to quote keys and Strings etc. For our example this would look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="n">johnId</span><span class="o">.</span><span class="n">touchListQuoted</span> <span class="o">===</span>
  <span class="s">s&#34;&#34;&#34;List(
</span><span class="s">     |  &#34;:db/id&#34; -&gt; 101L,
</span><span class="s">     |  &#34;:Person/age&#34;   -&gt; 24, 
</span><span class="s">     |  &#34;:Person/likes&#34; -&gt; &#34;pizza&#34;, 
</span><span class="s">     |  &#34;:Person/name&#34;  -&gt; &#34;John&#34;, 
</span><span class="s">     |  &#34;:Site/cat&#34;     -&gt; &#34;customer&#34;)&#34;&#34;&#34;</span><span class="o">.</span><span class="n">stripMargin</span>
</code></pre></div><p><code>touch</code>, <code>touchList</code> and <code>touchQuoted</code> can all have a max-depth applied.</p>
<h3 id="optional-attribute-values">Optional attribute values</h3>
<p>We can look for an optionally present attribute value. Here we ask the entity id <code>johnId</code> if it has a <code>:Site/cat</code> attribute value (of type <code>String</code>):</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="n">johnId</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&#34;:Site/cat&#34;</span><span class="o">)</span> <span class="o">===</span> <span class="nc">Some</span><span class="o">(</span><span class="s">&#34;customer&#34;</span><span class="o">)</span>
<span class="n">johnId</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="s">&#34;:Person/age&#34;</span><span class="o">)</span>  <span class="o">===</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">24</span><span class="o">)</span>

<span class="c1">// Likewise, a non-present attribute returns None
</span><span class="c1"></span><span class="n">johnId</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&#34;:Site/member&#34;</span><span class="o">)</span> <span class="o">===</span> <span class="nc">None</span> 
</code></pre></div><h2 id="generic-components">Generic components</h2>
<p>In the following sections, we&rsquo;ll refer to the 5 basic components E-A-V-T-Op of a <a href="../../intro/building-blocks/#datom">datom</a>:</p>





<table class="table table-bordered">
<thead>
<tr>
<th style="text-align:center">E</th>
<th style="text-align:center">A</th>
<th style="text-align:center">V</th>
<th style="text-align:center">T</th>
<th style="text-align:center">Op</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">johnId</td>
<td style="text-align:center">:Person/likes</td>
<td style="text-align:center">pizza</td>
<td style="text-align:center">t3</td>
<td style="text-align:center">true</td>
</tr>
</tbody>
</table>

<p>The T component can be either a point in time <code>t</code> in the database, a transaction entity id <code>tx</code> or transaction time <code>txInstant</code>.</p>
<p>In Molecule we use the following syntax for generic attributes to represent the various components of datoms:</p>





<table class="table table-bordered">
<thead>
<tr>
<th style="text-align:left">Generic attr</th>
<th style="text-align:left">Type</th>
<th style="text-align:center">Component</th>
<th style="text-align:left">Generic information</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>e</code></td>
<td style="text-align:left"><code>Long</code></td>
<td style="text-align:center">E</td>
<td style="text-align:left">Entity id</td>
</tr>
<tr>
<td style="text-align:left"><code>a</code></td>
<td style="text-align:left"><code>String</code></td>
<td style="text-align:center">A</td>
<td style="text-align:left">Attribute</td>
</tr>
<tr>
<td style="text-align:left"><code>v</code></td>
<td style="text-align:left"><code>Any</code></td>
<td style="text-align:center">V</td>
<td style="text-align:left">Value</td>
</tr>
<tr>
<td style="text-align:left"><code>t</code></td>
<td style="text-align:left"><code>Long</code></td>
<td style="text-align:center">T</td>
<td style="text-align:left">Point in time in database</td>
</tr>
<tr>
<td style="text-align:left"><code>tx</code></td>
<td style="text-align:left"><code>Long</code></td>
<td style="text-align:center">T</td>
<td style="text-align:left">Transaction entity id</td>
</tr>
<tr>
<td style="text-align:left"><code>txInstant</code></td>
<td style="text-align:left"><code>Date</code></td>
<td style="text-align:center">T</td>
<td style="text-align:left">Transaction time</td>
</tr>
<tr>
<td style="text-align:left"><code>op</code></td>
<td style="text-align:left"><code>Boolean</code></td>
<td style="text-align:center">Op</td>
<td style="text-align:left">Operation: assertion (true) / retraction (false)</td>
</tr>
</tbody>
</table>

<h2 id="datom-api">Datom API</h2>
<p>The Datom API in Molecule is a set of generic attributes, as described above, that can be mixed with your custom attributes to handle generic information.</p>
<p>Here are some examples:</p>
<p>Get the entity id with <code>e</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Person</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">head</span> <span class="o">===</span> <span class="o">(</span><span class="n">benId</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">)</span>
</code></pre></div><p>Get transaction info with <code>txInstant</code>, <code>t</code> or <code>tx</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// When was Ben&#39;s age updated?
</span><span class="c1"></span><span class="nc">Person</span><span class="o">(</span><span class="n">benId</span><span class="o">).</span><span class="n">age</span><span class="o">.</span><span class="n">txInstant</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">head</span> <span class="o">===</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="nc">Date</span><span class="o">(</span><span class="s">&#34;April 4, 2019&#34;</span><span class="o">))</span>

<span class="c1">// In which transaction entity was Ben&#39;s age updated?  
</span><span class="c1"></span><span class="nc">Person</span><span class="o">(</span><span class="n">benId</span><span class="o">).</span><span class="n">age</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">head</span> <span class="o">===</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="n">tx2</span><span class="o">)</span>

<span class="c1">// What&#39;s the transaction value t where Ben&#39;s age was updated?  
</span><span class="c1"></span><span class="nc">Person</span><span class="o">(</span><span class="n">benId</span><span class="o">).</span><span class="n">age</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">head</span> <span class="o">===</span> <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span>
</code></pre></div><p>With a history db we can access the point in time <code>t</code> in the database and assertion/retraction statuses with <code>op</code></p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// When was Ben&#39;s age updated back in time?
</span><span class="c1"></span><span class="nc">Person</span><span class="o">(</span><span class="n">benId</span><span class="o">).</span><span class="n">age</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">getHistory</span><span class="o">.</span><span class="n">sortBy</span><span class="o">(</span><span class="n">r</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="n">_2</span><span class="o">,</span> <span class="n">r</span><span class="o">.</span><span class="n">_3</span><span class="o">))</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="n">t1</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>  <span class="c1">// age 25 asserted in transaction t1
</span><span class="c1"></span>  <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="n">t2</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span> <span class="c1">// age 25 retracted in transaction t2
</span><span class="c1"></span>  <span class="o">(</span><span class="mi">26</span><span class="o">,</span> <span class="n">t2</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>   <span class="c1">// age 26 asserted in transaction t2
</span><span class="c1"></span><span class="o">)</span>
</code></pre></div><h3 id="fully-generic-datom-molecules">Fully generic Datom molecules</h3>
<p>Sometimes we will be interested in more generic data where we don&rsquo;t know in advance what attributes will be involved. Then we can use the generic Datom attribute <code>a</code> for Attribute name and <code>v</code> for value. We could for instance ask what we know about an entity over time in the database:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// What do we know about the johnId entity?
</span><span class="c1"></span><span class="nc">Person</span><span class="o">(</span><span class="n">johnId</span><span class="o">).</span><span class="n">a</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">getHistory</span><span class="o">.</span><span class="n">sortBy</span><span class="o">(</span><span class="n">r</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="n">_2</span><span class="o">,</span> <span class="n">r</span><span class="o">.</span><span class="n">_3</span><span class="o">))</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="s">&#34;John&#34;</span><span class="o">,</span> <span class="n">t3</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span> 
  <span class="o">(</span><span class="s">&#34;:Person/likes&#34;</span><span class="o">,</span> <span class="s">&#34;pizza&#34;</span><span class="o">,</span> <span class="n">t3</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span> 
  <span class="o">(</span><span class="s">&#34;:Person/likes&#34;</span><span class="o">,</span> <span class="s">&#34;pizza&#34;</span><span class="o">,</span> <span class="n">t6</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="o">(</span><span class="s">&#34;:Person/likes&#34;</span><span class="o">,</span> <span class="s">&#34;pasta&#34;</span><span class="o">,</span> <span class="n">t6</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>  
<span class="o">)</span>
</code></pre></div><h3 id="filtering-with-expressions">Filtering with expressions</h3>
<p>By applying values to generic attributes we can filter search results:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// What was asserted/retracted in transaction tx3 about what John likes? 
</span><span class="c1"></span><span class="nc">Person</span><span class="o">(</span><span class="n">johnId</span><span class="o">).</span><span class="n">likes</span><span class="o">.</span><span class="n">tx</span><span class="o">(</span><span class="n">tx6</span><span class="o">).</span><span class="n">op</span><span class="o">.</span><span class="n">getHistory</span><span class="o">.</span><span class="n">sortBy</span><span class="o">(</span><span class="n">r</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="n">_2</span><span class="o">,</span> <span class="n">r</span><span class="o">.</span><span class="n">_3</span><span class="o">))</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="s">&#34;pizza&#34;</span><span class="o">,</span> <span class="n">t6</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span> <span class="c1">// John no longer likes pizza
</span><span class="c1"></span>  <span class="o">(</span><span class="s">&#34;pasta&#34;</span><span class="o">,</span> <span class="n">t6</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>   <span class="c1">// John now likes pasta
</span><span class="c1"></span><span class="o">)</span>
</code></pre></div><h2 id="4-index-apis">4 Index APIs</h2>
<p><em>Some index descriptions in the following sections are respectfully quoted from the <a href="https://docs.datomic.com/on-prem/indexes.html">Datomic documentation</a>.</em></p>
<p>Datomic maintains four indexes that contain ordered sets of datoms. Each of these indexes is named based on the sort order used.  E, A, and V are always sorted in ascending order, while T is always in descending order:</p>
<ul>
<li><strong>EAVT</strong> - Datoms sorted by Entity-Attribute-Value-Transaction.</li>
<li><strong>AVET</strong> - Datoms sorted by Attribute-Value-Entity-Transaction.</li>
<li><strong>AEVT</strong> - Datoms sorted by Attribute-Entity-Value-Transaction.</li>
<li><strong>VAET</strong> - &ldquo;Reverse index&rdquo; for reverse lookup of ref types.</li>
</ul>
<p>Molecule provides access to each index by instantiating a corresponding Index object with one or more arguments and then adding generic attributes matching the data to be returned.</p>
<p>Contrary to Datomic&rsquo;s datoms API that returns Datoms, Molecule returns tuples of data matching the generic attributes added to the Index object. This way, Index molecules transparently share the same return type semantics as normal molecules.</p>
<h3 id="eavt">EAVT</h3>
<p>The EAVT index provides efficient access to everything about a given entity. Conceptually this is very similar to row access style in a SQL database, except that entities can possess arbitrary attributes rather then being limited to a predefined set of columns.</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// Create EAVT Index molecule with 1 entity id argument
</span><span class="c1"></span><span class="nc">EAVT</span><span class="o">(</span><span class="n">e1</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">,</span> <span class="n">t1</span><span class="o">),</span>
  <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="n">t2</span><span class="o">),</span>
  <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Golf/score&#34;</span><span class="o">,</span> <span class="mf">5.7</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span>
<span class="o">)</span>

<span class="c1">// Maybe we are only interested in the attribute/value pairs:
</span><span class="c1"></span><span class="nc">EAVT</span><span class="o">(</span><span class="n">e1</span><span class="o">).</span><span class="n">a</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">),</span>
  <span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">),</span>
  <span class="o">(</span><span class="s">&#34;:Golf/score&#34;</span><span class="o">,</span> <span class="mf">5.7</span><span class="o">)</span>
<span class="o">)</span>

<span class="c1">// Two arguments to narrow the search
</span><span class="c1"></span><span class="nc">EAVT</span><span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">).</span><span class="n">a</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div><h3 id="avet">AVET</h3>
<p>The AVET index provides efficient access to particular combinations of attribute and value.</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// Create AVET Index molecule with 1 entity id argument
</span><span class="c1"></span><span class="nc">AVET</span><span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">).</span><span class="n">v</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="n">t2</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="n">t5</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="n">e3</span><span class="o">,</span> <span class="n">t7</span><span class="o">)</span>
<span class="o">)</span>

<span class="c1">// Narrow search with multiple arguments
</span><span class="c1"></span><span class="nc">AVET</span><span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span> <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span> <span class="o">)</span>
<span class="nc">AVET</span><span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="n">e1</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span> <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span> <span class="o">)</span>
<span class="nc">AVET</span><span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="n">t2</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span> <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span> <span class="o">)</span>
</code></pre></div><p>The AVET Index can be filtered by a range of values between <code>from</code> (inclusive) and <code>until</code> (exclusive) for an attribute:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">AVET</span><span class="o">.</span><span class="n">range</span><span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">14</span><span class="o">),</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">20</span><span class="o">)).</span><span class="n">v</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="n">e4</span><span class="o">,</span> <span class="n">t7</span><span class="o">)</span> <span class="c1">// 14 is included in value range
</span><span class="c1"></span>               <span class="c1">// 23 not included in value range
</span><span class="c1"></span>               <span class="c1">// 25 outside value range
</span><span class="c1"></span><span class="o">)</span>

<span class="c1">// If `from` is None, the range starts from the beginning
</span><span class="c1"></span><span class="nc">AVET</span><span class="o">.</span><span class="n">range</span><span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">40</span><span class="o">)).</span><span class="n">v</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">14</span><span class="o">,</span> <span class="n">e3</span><span class="o">,</span> <span class="n">t7</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="n">t5</span><span class="o">)</span>
<span class="o">)</span>

<span class="c1">// If `until` is None, the range goes to the end
</span><span class="c1"></span><span class="nc">AVET</span><span class="o">.</span><span class="n">range</span><span class="o">(</span><span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">20</span><span class="o">),</span> <span class="nc">None</span><span class="o">).</span><span class="n">v</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="mi">23</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="n">t5</span><span class="o">),</span>
  <span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div><h3 id="aevt">AEVT</h3>
<p>The AEVT index provides efficient access to all values for a given attribute, comparable to traditional column access style.</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// Create AEVT Index molecule with 1 entity id argument
</span><span class="c1"></span><span class="nc">AEVT</span><span class="o">(</span><span class="s">&#34;:Person/name&#34;</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">,</span> <span class="n">t2</span><span class="o">),</span>
  <span class="o">(</span><span class="n">e2</span><span class="o">,</span> <span class="s">&#34;Liz&#34;</span><span class="o">,</span> <span class="n">t5</span><span class="o">)</span>
<span class="o">)</span>

<span class="c1">// Narrow search with multiple arguments
</span><span class="c1"></span><span class="nc">AEVT</span><span class="o">(</span><span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="n">e1</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span> <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">)</span> <span class="o">)</span>
<span class="nc">AEVT</span><span class="o">(</span><span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span> <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">)</span> <span class="o">)</span>
<span class="nc">AEVT</span><span class="o">(</span><span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">,</span> <span class="n">t2</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span> <span class="o">(</span><span class="n">e1</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">)</span> <span class="o">)</span>
</code></pre></div><h3 id="vaet">VAET</h3>
<p>The VAET index contains all and only datoms whose attribute has a :db/valueType of :db.type/ref. This is also known as the reverse index, since it allows efficient navigation of relationships in reverse.</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// Say we have 3 entities pointing to one entity:
</span><span class="c1"></span><span class="nc">Release</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="nc">Artists</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="n">r1</span><span class="o">,</span> <span class="s">&#34;Abbey Road&#34;</span><span class="o">,</span> <span class="n">a1</span><span class="o">,</span> <span class="s">&#34;The Beatles&#34;</span><span class="o">),</span>
  <span class="o">(</span><span class="n">r2</span><span class="o">,</span> <span class="s">&#34;Magical Mystery Tour&#34;</span><span class="o">,</span> <span class="n">a1</span><span class="o">,</span> <span class="s">&#34;The Beatles&#34;</span><span class="o">),</span>
  <span class="o">(</span><span class="n">r3</span><span class="o">,</span> <span class="s">&#34;Let it be&#34;</span><span class="o">,</span> <span class="n">a1</span><span class="o">,</span> <span class="s">&#34;The Beatles&#34;</span><span class="o">)</span>
<span class="o">)</span>

<span class="c1">// .. then we can get the reverse relationships with the VAET Index:
</span><span class="c1"></span><span class="nc">VAET</span><span class="o">(</span><span class="n">a1</span><span class="o">).</span><span class="n">v</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="s">&#34;:Release/artists&#34;</span><span class="o">,</span> <span class="n">r1</span><span class="o">),</span>
  <span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="s">&#34;:Release/artists&#34;</span><span class="o">,</span> <span class="n">r2</span><span class="o">),</span>
  <span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="s">&#34;:Release/artists&#34;</span><span class="o">,</span> <span class="n">r3</span><span class="o">)</span>
<span class="o">)</span>

<span class="c1">// Narrow search with multiple arguments
</span><span class="c1"></span><span class="nc">VAET</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="s">&#34;:Release/artist&#34;</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span><span class="n">r1</span><span class="o">,</span> <span class="n">r2</span><span class="o">,</span> <span class="n">r3</span><span class="o">)</span>
<span class="nc">VAET</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="s">&#34;:Release/artist&#34;</span><span class="o">,</span> <span class="n">r2</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span><span class="n">r2</span><span class="o">)</span>
<span class="nc">VAET</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="s">&#34;:Release/artist&#34;</span><span class="o">,</span> <span class="n">r2</span><span class="o">,</span> <span class="n">t7</span><span class="o">).</span><span class="n">e</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span><span class="n">r2</span><span class="o">)</span>
</code></pre></div><h2 id="log-api">Log API</h2>
<p><em>Some index descriptions in the following sections respectfully quoted from the <a href="https://docs.datomic.com/on-prem/log.html">Datomic documentation</a>.</em></p>
<p>Datomic&rsquo;s database log is a recording of all transaction data in historic order, organized for efficient access by transaction. The Log is therefore an efficient source of finding data by transaction time.</p>
<h3 id="tx-range-and-generic-log-attributes">Tx range and generic Log attributes</h3>
<p>The Molecule Log implementation takes two arguments to define a range of transactions between <code>from</code> (inclusive) and <code>until</code> (exclusive). One or more generic attributes are then added to the Log molecule to define what data to return.</p>
<p>Contrary to Datomic&rsquo;s Log implementation, Molecule returns data as a flat list of tuples of data that matches the generic attributes in the Log molecule. This is to transparently share the same return semantics as other molecules.</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// Data from transaction t1 (inclusive) until t4 (exclusive)
</span><span class="c1"></span><span class="nc">Log</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="n">t1</span><span class="o">),</span> <span class="nc">Some</span><span class="o">(</span><span class="n">t4</span><span class="o">)).</span><span class="n">t</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>
  <span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>

  <span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="s">&#34;Liz&#34;</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>
  <span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>

  <span class="o">(</span><span class="n">t3</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="o">(</span><span class="n">t3</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">26</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div><h3 id="from-beginning">From beginning</h3>
<p>If the <code>from</code> argument is <code>None</code> data from the beginning of the log is matched:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Log</span><span class="o">(</span><span class="nc">None</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="n">t3</span><span class="o">)).</span><span class="n">v</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="s">&#34;Ben&#34;</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>
  <span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>

  <span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="s">&#34;Liz&#34;</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>
  <span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>

  <span class="c1">// t3 not included
</span><span class="c1"></span><span class="o">)</span>
</code></pre></div><h3 id="until-end">Until end</h3>
<p>If the <code>until</code> argument is <code>None</code> data from until the end of the log is matched:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Log</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="n">t2</span><span class="o">),</span> <span class="nc">None</span><span class="o">).</span><span class="n">v</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="c1">// t1 not included
</span><span class="c1"></span>
  <span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="s">&#34;:Person/name&#34;</span><span class="o">,</span> <span class="s">&#34;Liz&#34;</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>
  <span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">e2</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="kc">true</span><span class="o">),</span>

  <span class="o">(</span><span class="n">t3</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">25</span><span class="o">,</span> <span class="kc">false</span><span class="o">),</span>
  <span class="o">(</span><span class="n">t3</span><span class="o">,</span> <span class="n">e1</span><span class="o">,</span> <span class="s">&#34;:Person/age&#34;</span><span class="o">,</span> <span class="mi">26</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div><h2 id="schema-api">Schema API</h2>
<p>A Datomic database schema is saved as data which makes it possible to make queries about the structure of the schema.</p>
<p>Query your schema with <code>Schema</code> and build on with schema attributes:</p>





<table class="table table-bordered">
<thead>
<tr>
<th style="text-align:left">Attribute</th>
<th style="text-align:left">Description</th>
<th style="text-align:left">Example value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>id</code></td>
<td style="text-align:left">Attribute definition entity id</td>
<td style="text-align:left"><code>Long</code></td>
</tr>
<tr>
<td style="text-align:left"><code>a</code></td>
<td style="text-align:left">(Partition-)Namespace-prefixed attribute name    </td>
<td style="text-align:left">&ldquo;:ind_Person/name&rdquo; or &ldquo;:Person/name&rdquo; if no partitions</td>
</tr>
<tr>
<td style="text-align:left"><code>part</code></td>
<td style="text-align:left">Partition name.</td>
<td style="text-align:left">&ldquo;ind&rdquo; or &quot;&quot; if no partitions</td>
</tr>
<tr>
<td style="text-align:left"><code>nsFull</code></td>
<td style="text-align:left">Namespace name with partition prefix</td>
<td style="text-align:left">&ldquo;ind_Person&rdquo; or &ldquo;Person&rdquo; if no partitions</td>
</tr>
<tr>
<td style="text-align:left"><code>ns</code></td>
<td style="text-align:left">Namespace name</td>
<td style="text-align:left">&ldquo;Person&rdquo;</td>
</tr>
<tr>
<td style="text-align:left"><code>attr</code></td>
<td style="text-align:left">Attribute name</td>
<td style="text-align:left">&ldquo;name&rdquo;</td>
</tr>
<tr>
<td style="text-align:left"><code>tpe</code></td>
<td style="text-align:left">Attribute Datomic type</td>
<td style="text-align:left">See types below</td>
</tr>
<tr>
<td style="text-align:left"><code>card</code></td>
<td style="text-align:left">Attribute cardinality</td>
<td style="text-align:left">&ldquo;one&rdquo;/&ldquo;many&rdquo;</td>
</tr>
<tr>
<td style="text-align:left"><code>doc</code></td>
<td style="text-align:left">Attribute documentation string</td>
<td style="text-align:left"><code>String</code></td>
</tr>
<tr>
<td style="text-align:left"><code>index</code></td>
<td style="text-align:left">Attribute index status</td>
<td style="text-align:left">true / not set</td>
</tr>
<tr>
<td style="text-align:left"><code>unique</code></td>
<td style="text-align:left">Attribute uniqueness status</td>
<td style="text-align:left">true / not set</td>
</tr>
<tr>
<td style="text-align:left"><code>fulltext</code></td>
<td style="text-align:left">Attribute fulltext search status</td>
<td style="text-align:left">true / not set</td>
</tr>
<tr>
<td style="text-align:left"><code>isComponent</code>   </td>
<td style="text-align:left">Attribute isComponent status</td>
<td style="text-align:left">true / not set</td>
</tr>
<tr>
<td style="text-align:left"><code>noHistory</code></td>
<td style="text-align:left">Attribute noHistory status</td>
<td style="text-align:left">true / not set</td>
</tr>
<tr>
<td style="text-align:left"><code>enum</code></td>
<td style="text-align:left">Attribute enum values</td>
<td style="text-align:left"><code>String</code></td>
</tr>
<tr>
<td style="text-align:left"><code>t</code></td>
<td style="text-align:left">Attribute definition transaction point in time</td>
<td style="text-align:left"><code>Long</code> / <code>Int</code></td>
</tr>
<tr>
<td style="text-align:left"><code>tx</code></td>
<td style="text-align:left">Attribute definition transaction entity id</td>
<td style="text-align:left"><code>Long</code></td>
</tr>
<tr>
<td style="text-align:left"><code>txInstant</code></td>
<td style="text-align:left">Attribute definition transaction wall-clock time</td>
<td style="text-align:left"><code>java.util.Date</code></td>
</tr>
</tbody>
</table>

<p>Since the schema is based on your Data Model, Schema queries are also a way to query your Data Model.</p>
<p>Datomic&rsquo;s bootstrapped attributes are transparently filtered out so that only custom schema data based on your Data Model is returned.</p>
<p>Here are some examples:</p>
<h3 id="attribute-names">Attribute names</h3>
<p>Here we find various elements of attribute names:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Schema</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">part</span><span class="o">.</span><span class="n">ns</span><span class="o">.</span><span class="n">nsFull</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span> <span class="o">(</span>
  <span class="o">(</span><span class="s">&#34;:sales_Customer/name&#34;</span><span class="o">,</span> <span class="s">&#34;sales&#34;</span><span class="o">,</span> <span class="s">&#34;Customer&#34;</span><span class="o">,</span> <span class="s">&#34;sales_Customer&#34;</span><span class="o">,</span> <span class="s">&#34;name&#34;</span><span class="o">),</span>
  <span class="o">(</span><span class="s">&#34;:accounting_Invoice/invoiceLine&#34;</span><span class="o">,</span> <span class="s">&#34;accounting&#34;</span><span class="o">,</span> <span class="s">&#34;Invoice&#34;</span><span class="o">,</span> <span class="s">&#34;accounting_Invoice&#34;</span><span class="o">,</span> <span class="s">&#34;invoiceLine&#34;</span><span class="o">),</span>
  <span class="c1">// etc..
</span><span class="c1"></span><span class="o">)</span>
</code></pre></div><h3 id="types-and-cardinality">Types and cardinality</h3>
<p>Datomic type and cardinality of attributes</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Schema</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">tpe</span><span class="o">.</span><span class="n">card</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span> <span class="o">(</span>
  <span class="o">(</span><span class="s">&#34;:sales_Customer/name&#34;</span><span class="o">,</span> <span class="s">&#34;string&#34;</span><span class="o">,</span> <span class="s">&#34;one&#34;</span><span class="o">),</span>
  <span class="o">(</span><span class="s">&#34;:accounting_Invoice/invoiceLine&#34;</span><span class="o">,</span> <span class="s">&#34;ref&#34;</span><span class="o">,</span> <span class="s">&#34;many&#34;</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div><p>Scala <code>Int</code> and <code>Long</code> are both represented as Datomic type <code>long</code>:</p>





<table class="table table-bordered">
<thead>
<tr>
<th style="text-align:left">Datomic type    </th>
<th style="text-align:left">Scala type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><em>string</em></td>
<td style="text-align:left"><code>String</code></td>
</tr>
<tr>
<td style="text-align:left"><em>long</em></td>
<td style="text-align:left"><code>Int</code></td>
</tr>
<tr>
<td style="text-align:left"><em>long</em></td>
<td style="text-align:left"><code>Long</code></td>
</tr>
<tr>
<td style="text-align:left"><em>float</em></td>
<td style="text-align:left"><code>Float</code></td>
</tr>
<tr>
<td style="text-align:left"><em>double</em></td>
<td style="text-align:left"><code>Double</code></td>
</tr>
<tr>
<td style="text-align:left"><em>bigint</em></td>
<td style="text-align:left"><code>BigInt</code></td>
</tr>
<tr>
<td style="text-align:left"><em>bigdec</em></td>
<td style="text-align:left"><code>BigDecimal</code></td>
</tr>
<tr>
<td style="text-align:left"><em>boolean</em></td>
<td style="text-align:left"><code>Boolean</code></td>
</tr>
<tr>
<td style="text-align:left"><em>instant</em></td>
<td style="text-align:left"><code>java.util.Date</code></td>
</tr>
<tr>
<td style="text-align:left"><em>uuid</em></td>
<td style="text-align:left"><code>java.util.UUID</code></td>
</tr>
<tr>
<td style="text-align:left"><em>uri</em></td>
<td style="text-align:left"><code>java.net.URI</code></td>
</tr>
<tr>
<td style="text-align:left"><em>ref</em></td>
<td style="text-align:left"><code>Long</code></td>
</tr>
</tbody>
</table>

<h3 id="optional-docs-and-attribute-options">Optional docs and attribute options</h3>
<p>These can be retrieved as mandatory or optional attribute values:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Schema</span><span class="o">.</span><span class="n">a</span>
      <span class="o">.</span><span class="n">index</span>
      <span class="o">.</span><span class="n">doc$</span>
      <span class="o">.</span><span class="n">unique$</span>
      <span class="o">.</span><span class="n">fulltext$</span>
      <span class="o">.</span><span class="n">isComponent$</span>
      <span class="o">.</span><span class="n">noHistory$</span>
      <span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="s">&#34;:sales_Customer/name&#34;</span><span class="o">,</span>
    <span class="kc">true</span><span class="o">,</span>            <span class="c1">// indexed
</span><span class="c1"></span>    <span class="s">&#34;Customer name&#34;</span><span class="o">,</span> <span class="c1">// doc
</span><span class="c1"></span>    <span class="nc">None</span><span class="o">,</span>            <span class="c1">// Uniqueness not set
</span><span class="c1"></span>    <span class="nc">Some</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>      <span class="c1">// Fulltext search set so that we can search for names
</span><span class="c1"></span>    <span class="nc">None</span><span class="o">,</span>            <span class="c1">// Not a component
</span><span class="c1"></span>    <span class="nc">None</span>             <span class="c1">// History is preserved (noHistory not set)
</span><span class="c1"></span>    <span class="o">),</span>
  <span class="o">(</span><span class="s">&#34;:accounting_Invoice/invoiceLine&#34;</span><span class="o">,</span>
    <span class="kc">true</span><span class="o">,</span>                   <span class="c1">// indexed
</span><span class="c1"></span>    <span class="s">&#34;Ref to Invoice lines&#34;</span><span class="o">,</span> <span class="c1">// doc
</span><span class="c1"></span>    <span class="nc">None</span><span class="o">,</span>                   <span class="c1">// Uniqueness not set
</span><span class="c1"></span>    <span class="nc">None</span><span class="o">,</span>                   <span class="c1">// Fulltext search not set
</span><span class="c1"></span>    <span class="nc">Some</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>             <span class="c1">// Invoice is a component - owns invoice lines
</span><span class="c1"></span>    <span class="nc">None</span>                    <span class="c1">// History is preserved (noHistory not set)
</span><span class="c1"></span>    <span class="o">),</span>
<span class="o">)</span>
</code></pre></div><h3 id="enum-values">Enum values</h3>
<p>Enumerated values can be defined in the schema and then retrieved generically with <code>Schema.enum</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="c1">// Defined enum values
</span><span class="c1"></span><span class="nc">Schema</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">enum</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">groupBy</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">_1</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">g</span> <span class="k">=&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">_1</span> <span class="o">-&gt;</span> <span class="n">g</span><span class="o">.</span><span class="n">_2</span><span class="o">)</span> <span class="o">===</span> <span class="nc">Map</span><span class="o">(</span>
  <span class="s">&#34;:Person/gender&#34;</span> <span class="o">-&gt;</span> <span class="nc">List</span><span class="o">(</span><span class="s">&#34;female&#34;</span><span class="o">,</span> <span class="s">&#34;male&#34;</span><span class="o">),</span>
  <span class="s">&#34;:Interests/sports&#34;</span> <span class="o">-&gt;</span> <span class="nc">List</span><span class="o">(</span><span class="s">&#34;golf&#34;</span><span class="o">,</span> <span class="s">&#34;basket&#34;</span><span class="o">,</span> <span class="s">&#34;badminton&#34;</span><span class="o">)</span>
<span class="o">)</span>
</code></pre></div><h3 id="schema-transaction-times">Schema transaction times</h3>
<p>&ldquo;In what transaction/when were the attributes created in the schema?&rdquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-scala" data-lang="scala"><span class="nc">Schema</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">txInstant</span><span class="o">.</span><span class="n">get</span> <span class="o">===</span> <span class="nc">List</span><span class="o">(</span>
  <span class="o">(</span><span class="n">t1</span><span class="o">,</span> <span class="n">tx1</span><span class="o">,</span> <span class="o">&lt;</span><span class="nc">Date</span><span class="k">:</span> <span class="err">2018</span><span class="kt">-</span><span class="err">11</span><span class="kt">-</span><span class="err">07</span> <span class="err">09</span><span class="kt">:</span><span class="err">28</span><span class="kt">:</span><span class="err">10</span><span class="kt">&gt;</span><span class="o">),</span> <span class="c1">// Initial schema transaction
</span><span class="c1"></span>  <span class="o">(</span><span class="n">t2</span><span class="o">,</span> <span class="n">tx2</span><span class="o">,</span> <span class="o">&lt;</span><span class="nc">Date</span><span class="k">:</span> <span class="err">2019</span><span class="kt">-</span><span class="err">01</span><span class="kt">-</span><span class="err">12</span> <span class="err">12</span><span class="kt">:</span><span class="err">43</span><span class="kt">:</span><span class="err">27</span><span class="kt">&gt;</span><span class="o">),</span> <span class="c1">// Additional schema attribute definitions...
</span><span class="c1"></span><span class="o">)</span>
</code></pre></div>
    </div>

    <div class="col-sm-2" style="padding-left:24px;padding-right: 0px;position:sticky;top:115px">
        
<button type="button" id="sidebarCollapse" class="navbar-toggle collapsed" data-toggle="collapse" style="color:#bbb">
  <i class="glyphicon glyphicon-align-left"></i>
</button>

<nav class="bs-docs-sidebar" id="sidebar">
  <ul class="bs-docs-sidenav nav">
    
      

        
        
          
            <li><a href="../../code/">Overview</a></li>
          
          
        
          
            <li><a href="../../code/attributes/">Attributes</a></li>
          
          
        
          
            <li><a href="../../code/relationships/">Relationships</a></li>
          
          
        
          
            <li><a href="../../code/transactions/">Transactions</a></li>
          
          
        
          
            <li><a href="../../code/transaction-functions/">Transaction Functions</a></li>
          
          
        
          
            <li><a href="../../code/time/">Time</a></li>
          
          
        
          
            <li class="open"><a href="../../code/generic/"><b>Generic APIs</b></a></li>
            
              <nav id="TableOfContents">
  <ul>
    <li><a href="#entity-api">Entity API</a></li>
    <li><a href="#generic-components">Generic components</a></li>
    <li><a href="#datom-api">Datom API</a></li>
    <li><a href="#4-index-apis">4 Index APIs</a></li>
    <li><a href="#log-api">Log API</a></li>
    <li><a href="#schema-api">Schema API</a></li>
  </ul>
</nav>
            
          
          
        
          
            <li><a href="../../code/dynamic/">Dynamic molecules</a></li>
          
          
        

      
    
  </ul>
</nav>
    </div>

</div> 

     
   
 


</div> 

<footer class="bs-docs-footer">

  <div class="container" style="font-size:15px">
    <ul class="bs-docs-footer-links">
      <li style="margin-top: 8px;"><a href="../../front/"><img src="../../img/logo/MoleculeLogo150.png" alt=""></a></li>
      <li><a href="https://github.com/scalamolecule/molecule">GitHub</a></li>
      <li><a href="https://github.com/scalamolecule/molecule-web">GitHub-web</a></li>
      <li><a href="https://gitter.im/scalamolecule/Lobby">Gitter</a></li>
      <li><a href="https://groups.google.com/forum/#!forum/molecule-dsl">Forum</a></li>
      <li><a href="../../about/">About</a></li>
      <li><a href="../../credits/">Credits</a></li>
      <li><a href="../../changelog">Changelog</a></li>
    </ul>
    <p>Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="license">Apache License 2.0</a></p>
  </div>
</footer>


<script type="text/javascript" src="../../js/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="../../js/bootstrap.min.js"></script>


<script type="text/javascript" src="../../js/scripts.js"></script>
<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
<script src="../../js/copy-button.js"></script>
<script src="../../js/sidebar-collapser.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2787756-3', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
